

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ethereum Simulations &mdash; The EVM Jello Paper 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex/"/>
        <link rel="search" title="Search" href="../search/"/>
    <link rel="top" title="The EVM Jello Paper 0.1 documentation" href="../"/>
        <link rel="next" title="KEVM Verification" href="../verification/"/>
        <link rel="prev" title="EVM Execution" href="../evm/"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../" class="icon icon-home"> The EVM Jello Paper
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../evm/">EVM Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#evm-programs">EVM Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#precompiled-contracts">Precompiled Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#ethereum-gas-calculation">Ethereum Gas Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#evm-program-representations">EVM Program Representations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Ethereum Simulations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#driving-execution">Driving Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-tests">Running Tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#state-manipulation">State Manipulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#clearing-state">Clearing State</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-state">Loading State</a></li>
<li class="toctree-l2"><a class="reference internal" href="#checking-state">Checking State</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../verification/">KEVM Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/">EVM Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/#data-structures">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/#parsing-unparsing">Parsing/Unparsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/#recursive-length-prefix-rlp">Recursive Length Prefix (RLP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis/">Analysis Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../krypto/">Cryptographic Primitives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/">EVM Design Issues</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">The EVM Jello Paper</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../">Docs</a> &raquo;</li>
        
      <li>Ethereum Simulations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/ethereum.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ethereum-simulations">
<h1>Ethereum Simulations<a class="headerlink" href="#ethereum-simulations" title="Permalink to this headline">¶</a></h1>
<p>Ethereum is using the EVM to drive updates over the world state. Actual
execution of the EVM is defined in <a class="reference external" href="evm.md">the EVM file</a>.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="nv">requires</span><span class="w"> </span><span class="s">&quot;verification.k&quot;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="nv">requires</span><span class="w"> </span><span class="s">&quot;evm.k&quot;</span><span class="w"></span>
<span class="nv">requires</span><span class="w"> </span><span class="s">&quot;analysis.k&quot;</span><span class="w"></span>

<span class="nv">module</span><span class="w"> </span><span class="nv">ETHEREUM</span><span class="err">-</span><span class="nv">SIMULATION</span><span class="w"></span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="nv">EVM</span><span class="w"></span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="nv">EVM</span><span class="err">-</span><span class="nv">ANALYSIS</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="nv">imports</span><span class="w"> </span><span class="nv">VERIFICATION</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="nv">imports</span><span class="w"> </span><span class="nv">K</span><span class="err">-</span><span class="nv">REFLECTION</span><span class="w"></span>
</pre></div>
</div>
<p>An Ethereum simulation is a list of Ethereum commands. Some Ethereum
commands take an Ethereum specification (eg. for an account or
transaction).</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumSimulation</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;.EthereumSimulation&quot;</span><span class="w"></span>
<span class="w">                               </span><span class="o">|</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="nv">EthereumSimulation</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="p">.</span><span class="nv">EthereumSimulation</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">ETC</span><span class="p">:</span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="nv">ETS</span><span class="p">:</span><span class="nv">EthereumSimulation</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ETC</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">ETS</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumSimulation</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">JSON</span><span class="w"></span>
<span class="c1">// ----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">JSONINPUT</span><span class="p">:</span><span class="nv">JSON</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">JSONINPUT</span><span class="w"> </span><span class="nv">success</span><span class="w"> </span><span class="p">.</span><span class="nv">EthereumSimulation</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>For verification purposes, it’s much easier to specify a program in
terms of its op-codes and not the hex-encoding that the tests use. To do
so, we’ll extend sort <code class="docutils literal"><span class="pre">JSON</span></code> with some EVM specific syntax, and
provide a “pretti-fication” to the nicer input form.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">JSON</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">Call</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">SubstateLogEntry</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">Account</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------------------------------------</span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#sortJSONList</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="p">)</span><span class="w">            </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="nv">#sortJSONList</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#sortJSONListAux</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sortJSONList</span><span class="p">(</span><span class="nv">JS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sortJSONList</span><span class="p">(</span><span class="nv">JS</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sortJSONList</span><span class="p">(.</span><span class="nv">JSONList</span><span class="p">,</span><span class="w"> </span><span class="nv">LS</span><span class="p">)</span><span class="w">            </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">LS</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sortJSONList</span><span class="p">(((</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="p">),</span><span class="w"> </span><span class="nv">LS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#insertJSONKey</span><span class="p">((</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="p">),</span><span class="w"> </span><span class="nv">#sortJSONList</span><span class="p">(</span><span class="nv">REST</span><span class="p">,</span><span class="w"> </span><span class="nv">LS</span><span class="p">))</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#insertJSONKey</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">JSON</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#insertJSONKey</span><span class="p">(</span><span class="w"> </span><span class="nv">JS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">JS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#insertJSONKey</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="nv">KEY</span><span class="err">&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="p">)</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="err">&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="err">&#39;</span><span class="p">)</span><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">String</span><span class="w"> </span><span class="nv">KEY</span><span class="err">&#39;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#insertJSONKey</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="nv">KEY</span><span class="err">&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="err">&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">#insertJSONKey</span><span class="p">((</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">String</span><span class="w"> </span><span class="nv">KEY</span><span class="err">&#39;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#isSorted</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#isSorted</span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">true</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#isSorted</span><span class="p">(</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">true</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#isSorted</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="err">&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">String</span><span class="w"> </span><span class="nv">KEY</span><span class="err">&#39;</span><span class="w"> </span><span class="nv">andThenBool</span><span class="w"> </span><span class="nv">#isSorted</span><span class="p">((</span><span class="nv">KEY</span><span class="err">&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="driving-execution">
<h2>Driving Execution<a class="headerlink" href="#driving-execution" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">start</span></code> places <code class="docutils literal"><span class="pre">#next</span></code> on the <code class="docutils literal"><span class="pre">&lt;k&gt;</span></code> cell so that execution of
the loaded state begin.</li>
<li><code class="docutils literal"><span class="pre">flush</span></code> places <code class="docutils literal"><span class="pre">#finalize</span></code> on the <code class="docutils literal"><span class="pre">&lt;k&gt;</span></code> cell once it sees
<code class="docutils literal"><span class="pre">#end</span></code> in the <code class="docutils literal"><span class="pre">&lt;k&gt;</span></code> cell, clearing any exceptions it finds.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;start&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">NORMAL</span><span class="w">     </span><span class="nt">&lt;/mode&gt;</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#execute</span><span class="w">    </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w">    </span><span class="nt">&lt;/mode&gt;</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#execute</span><span class="w">    </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">GASANALYZE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#gasAnalyze</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;flush&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w">       </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">flush</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">false</span><span class="p">)</span><span class="w">               </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">flush</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">startTx</span></code> computes the sender of the transaction, and places loadTx
on the <code class="docutils literal"><span class="pre">k</span></code> cell.</li>
<li><code class="docutils literal"><span class="pre">loadTx(_)</span></code> loads the next transaction to be executed into the
current state.</li>
<li><code class="docutils literal"><span class="pre">finishTx</span></code> is a place-holder for performing necessary cleanup after
a transaction.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;startTx&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">startTx</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#finalizeBlock</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">startTx</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">loadTx</span><span class="p">(</span><span class="nv">#sender</span><span class="p">(</span><span class="nv">TN</span><span class="p">,</span><span class="w"> </span><span class="nv">TP</span><span class="p">,</span><span class="w"> </span><span class="nv">TG</span><span class="p">,</span><span class="w"> </span><span class="nv">TT</span><span class="p">,</span><span class="w"> </span><span class="nv">TV</span><span class="p">,</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">DATA</span><span class="p">),</span><span class="w"> </span><span class="nv">TW</span><span class="p">,</span><span class="w"> </span><span class="nv">TR</span><span class="p">,</span><span class="w"> </span><span class="nv">TS</span><span class="p">))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;message&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;msgID&gt;</span><span class="w">      </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txNonce&gt;</span><span class="w">    </span><span class="nv">TN</span><span class="w">   </span><span class="nt">&lt;/txNonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txGasPrice&gt;</span><span class="w"> </span><span class="nv">TP</span><span class="w">   </span><span class="nt">&lt;/txGasPrice&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txGasLimit&gt;</span><span class="w"> </span><span class="nv">TG</span><span class="w">   </span><span class="nt">&lt;/txGasLimit&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;to&gt;</span><span class="w">         </span><span class="nv">TT</span><span class="w">   </span><span class="nt">&lt;/to&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;value&gt;</span><span class="w">      </span><span class="nv">TV</span><span class="w">   </span><span class="nt">&lt;/value&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;v&gt;</span><span class="w">          </span><span class="nv">TW</span><span class="w">   </span><span class="nt">&lt;/v&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;r&gt;</span><span class="w">          </span><span class="nv">TR</span><span class="w">   </span><span class="nt">&lt;/r&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;s&gt;</span><span class="w">          </span><span class="nv">TS</span><span class="w">   </span><span class="nt">&lt;/s&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;data&gt;</span><span class="w">       </span><span class="nv">DATA</span><span class="w"> </span><span class="nt">&lt;/data&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">loadTx</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="c1">// -----------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">loadTx</span><span class="p">(</span><span class="nv">ACCTFROM</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#create</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">#newAddr</span><span class="p">(</span><span class="nv">ACCTFROM</span><span class="p">,</span><span class="w"> </span><span class="nv">NONCE</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">GLIMIT</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">G0</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CODE</span><span class="p">,</span><span class="w"> </span><span class="nv">true</span><span class="p">))</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">CODE</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#execute</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finishTx</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">startTx</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gasPrice&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="nt">&lt;/gasPrice&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;origin&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/origin&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;message&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;msgID&gt;</span><span class="w">      </span><span class="nv">TXID</span><span class="w">     </span><span class="nt">&lt;/msgID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txGasPrice&gt;</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w">   </span><span class="nt">&lt;/txGasPrice&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txGasLimit&gt;</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w">   </span><span class="nt">&lt;/txGasLimit&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;to&gt;</span><span class="w">         </span><span class="p">.</span><span class="nv">Account</span><span class="w"> </span><span class="nt">&lt;/to&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;value&gt;</span><span class="w">      </span><span class="nv">VALUE</span><span class="w">    </span><span class="nt">&lt;/value&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;data&gt;</span><span class="w">       </span><span class="nv">CODE</span><span class="w">     </span><span class="nt">&lt;/data&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">GLIMIT</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GPRICE</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">loadTx</span><span class="p">(</span><span class="nv">ACCTFROM</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#call</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="p">(</span><span class="nv">GLIMIT</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">G0</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">DATA</span><span class="p">,</span><span class="w"> </span><span class="nv">false</span><span class="p">))</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">DATA</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#execute</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finishTx</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">startTx</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gasPrice&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="nt">&lt;/gasPrice&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;origin&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/origin&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;message&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;msgID&gt;</span><span class="w">      </span><span class="nv">TXID</span><span class="w">   </span><span class="nt">&lt;/msgID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txGasPrice&gt;</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="nt">&lt;/txGasPrice&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txGasLimit&gt;</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nt">&lt;/txGasLimit&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;to&gt;</span><span class="w">         </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nt">&lt;/to&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;value&gt;</span><span class="w">      </span><span class="nv">VALUE</span><span class="w">  </span><span class="nt">&lt;/value&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;data&gt;</span><span class="w">       </span><span class="nv">DATA</span><span class="w">   </span><span class="nt">&lt;/data&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">GLIMIT</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GPRICE</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">Account</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#finishTx&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finishTx</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#popWorldState</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#popSubstate</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finishTx</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#mkCodeDeposit</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;message&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w">     </span><span class="nt">&lt;/msgID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;to&gt;</span><span class="w">    </span><span class="p">.</span><span class="nv">Account</span><span class="w"> </span><span class="nt">&lt;/to&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finishTx</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#dropWorldState</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#dropSubstate</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#refund</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;message&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;to&gt;</span><span class="w">    </span><span class="nv">TT</span><span class="w">   </span><span class="nt">&lt;/to&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">TT</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">Account</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#finalizeBlock</span></code> is used to signal that block finalization
procedures should take place (after transactions have executed).</li>
<li><code class="docutils literal"><span class="pre">#rewardOmmers(_)</span></code> pays out the reward to uncle blocks so that
blocks are orphaned less often in Ethereum.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#finalizeBlock&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">#rewardOmmers</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="c1">// ------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#finalizeBlock</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rewardOmmers</span><span class="p">(</span><span class="nv">OMMERS</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;ommerBlockHeaders&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OMMERS</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nt">&lt;/ommerBlockHeaders&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;coinbase&gt;</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">MINBAL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MINBAL</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Rb</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="p">(.</span><span class="nv">K</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">MINER</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finalizeBlock</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;coinbase&gt;</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#rewardOmmers</span><span class="p">(.</span><span class="nv">JSONList</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#rewardOmmers</span><span class="p">([</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">OMMER</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">OMMNUM</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rewardOmmers</span><span class="p">(</span><span class="nv">REST</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;coinbase&gt;</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;number&gt;</span><span class="w"> </span><span class="nv">CURNUM</span><span class="w"> </span><span class="nt">&lt;/number&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">MINBAL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MINBAL</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Rb</span><span class="w"> </span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">         </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">OMMER</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">OMMBAL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">OMMBAL</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Rb</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">OMMNUM</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">CURNUM</span><span class="p">)</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">Rb</span><span class="w"> </span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">         </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="nv">OMMER</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;Rb&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Rb</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="err">^</span><span class="nv">Int</span><span class="w"> </span><span class="mi">18</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">exception</span></code> only clears from the <code class="docutils literal"><span class="pre">&lt;k&gt;</span></code> cell if there is an
exception preceding it.</li>
<li><code class="docutils literal"><span class="pre">failure_</span></code> holds the name of a test that failed if a test does
fail.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;exception&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;failure&quot;</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">exception</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">success</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">exit</span><span class="err">-</span><span class="nv">code</span><span class="err">&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">&lt;/</span><span class="nv">exit</span><span class="err">-</span><span class="nv">code</span><span class="err">&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="running-tests">
<h2>Running Tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">run</span></code> runs a given set of Ethereum tests (from the test-set).</li>
</ul>
<p>Note that <code class="docutils literal"><span class="pre">TEST</span></code> is sorted here so that key <code class="docutils literal"><span class="pre">&quot;network&quot;</span></code> comes before
key <code class="docutils literal"><span class="pre">&quot;pre&quot;</span></code>.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;run&quot;</span><span class="w"> </span><span class="nv">JSON</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">TEST</span><span class="p">:</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">TESTS</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">#sortJSONList</span><span class="p">(</span><span class="nv">TEST</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">#hasPost</span><span class="err">?</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">TEST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="p">.</span><span class="nv">K</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">exception</span><span class="w"> </span><span class="nv">#fi</span><span class="w"></span>
<span class="w">     </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">clear</span><span class="w"></span>
<span class="w">     </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">TESTS</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#hasPost?&quot;</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span><span class="nv">JSON</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#hasPost</span><span class="err">?</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#hasPost</span><span class="err">?</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">#postKeys</span><span class="p">)</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">#hasPost</span><span class="err">?</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#loadKeys</span></code> are all the JSON nodes which should be considered as
loads before execution.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#loadKeys&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#loadKeys</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;env&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;pre&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;rlp&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;network&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;genesisRLP&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">JSON</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">#loadKeys</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;blocks&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">REST1</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">REST2</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;blocks&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#execKeys</span></code> are all the JSON nodes which should be considered for
execution (between loading and checking).</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#execKeys&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#execKeys</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;exec&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;lastblockhash&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">JSON</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">NEXT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">NEXT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">#execKeys</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">EXEC</span><span class="p">:</span><span class="nv">JSON</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">EXEC</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">flush</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;lastblockhash&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">HASH</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">startTx</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#postKeys</span></code> are a subset of <code class="docutils literal"><span class="pre">#checkKeys</span></code> which correspond to
post-state account checks.</li>
<li><code class="docutils literal"><span class="pre">#checkKeys</span></code> are all the JSON nodes which should be considered as
checks after execution.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#postKeys&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#allPostKeys&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#checkKeys&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#postKeys</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;post&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;postState&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#allPostKeys</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">#postKeys</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;expect&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;export&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;expet&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#checkKeys</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">#allPostKeys</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;logs&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;callcreates&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;out&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;gas&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                          </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;blockHeader&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;transactions&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;uncleHeaders&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;genesisBlockHeader&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">JSON</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;post&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">#allPostKeys</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">JSON</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="nv">VAL</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">#checkKeys</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">#allPostKeys</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#discardKeys</span></code> are all the JSON nodes in the tests which should
just be ignored.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#discardKeys&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#discardKeys</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;_info&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">#discardKeys</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="state-manipulation">
<h3>State Manipulation<a class="headerlink" href="#state-manipulation" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="clearing-state">
<h2>Clearing State<a class="headerlink" href="#clearing-state" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">clear</span></code> clears all the execution state of the machine.</li>
<li><code class="docutils literal"><span class="pre">clearX</span></code> clears the substate <code class="docutils literal"><span class="pre">X</span></code>, for <code class="docutils literal"><span class="pre">TX</span></code>, <code class="docutils literal"><span class="pre">BLOCK</span></code>, and
<code class="docutils literal"><span class="pre">NETWORK</span></code>.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;clear&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">clear</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">clearTX</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">clearBLOCK</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">clearNETWORK</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;analysis&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w"> </span><span class="nt">&lt;/analysis&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthreumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;clearTX&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">clearTX</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;output&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;memoryUsed&gt;</span><span class="w">   </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/memoryUsed&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callStack&gt;</span><span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w">      </span><span class="nt">&lt;/callStack&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callLog&gt;</span><span class="w">      </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Set</span><span class="w">       </span><span class="nt">&lt;/callLog&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;program&gt;</span><span class="w">      </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w">       </span><span class="nt">&lt;/program&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;programBytes&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/programBytes&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w">           </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;caller&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/caller&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callValue&gt;</span><span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/callValue&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;wordStack&gt;</span><span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w">       </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;pc&gt;</span><span class="w">           </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w">          </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;previousGas&gt;</span><span class="w">  </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/previousGas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;selfDestruct&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Set</span><span class="w">       </span><span class="nt">&lt;/selfDestruct&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;log&gt;</span><span class="w">          </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w">      </span><span class="nt">&lt;/log&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;refund&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/refund&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gasPrice&gt;</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/gasPrice&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;origin&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/origin&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthreumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;clearBLOCK&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">clearBLOCK</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;previousHash&gt;</span><span class="w">      </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/previousHash&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;ommersHash&gt;</span><span class="w">        </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/ommersHash&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;coinbase&gt;</span><span class="w">          </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;stateRoot&gt;</span><span class="w">         </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/stateRoot&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;transactionsRoot&gt;</span><span class="w">  </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/transactionsRoot&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;receiptsRoot&gt;</span><span class="w">      </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/receiptsRoot&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;logsBloom&gt;</span><span class="w">         </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w">    </span><span class="nt">&lt;/logsBloom&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;difficulty&gt;</span><span class="w">        </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/difficulty&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;number&gt;</span><span class="w">            </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/number&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gasLimit&gt;</span><span class="w">          </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/gasLimit&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gasUsed&gt;</span><span class="w">           </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/gasUsed&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;timestamp&gt;</span><span class="w">         </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/timestamp&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;extraData&gt;</span><span class="w">         </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w">    </span><span class="nt">&lt;/extraData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mixHash&gt;</span><span class="w">           </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/mixHash&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;blockNonce&gt;</span><span class="w">        </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">             </span><span class="nt">&lt;/blockNonce&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;ommerBlockHeaders&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nt">&lt;/ommerBlockHeaders&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;blockhash&gt;</span><span class="w">         </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w">         </span><span class="nt">&lt;/blockhash&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthreumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;clearNETWORK&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">clearNETWORK</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w">    </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;accounts&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Bag</span><span class="w">    </span><span class="nt">&lt;/accounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;messages&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Bag</span><span class="w">    </span><span class="nt">&lt;/messages&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="loading-state">
<h2>Loading State<a class="headerlink" href="#loading-state" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">mkAcct_</span></code> creates an account with the supplied ID (assuming it’s
already been chopped to 160 bits).</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;mkAcct&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="c1">// ---------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">mkAcct</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">load</span></code> loads an account or transaction into the world state.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;load&quot;</span><span class="w"> </span><span class="nv">JSON</span><span class="w"></span>
<span class="c1">// --------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">=/=</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;transaction&quot;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">TEST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">TEST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
</pre></div>
</div>
<p>Here we perform pre-proccesing on account data which allows “pretty”
specification of input.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;pre&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCTID</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">mkAcct</span><span class="w"> </span><span class="nv">#parseAddr</span><span class="p">(</span><span class="nv">ACCTID</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCTID</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"></span>

<span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">((</span><span class="nv">ACCTID</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseAddr</span><span class="p">(</span><span class="nv">ACCTID</span><span class="p">))</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCT</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;balance&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">VAL</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCT</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;nonce&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">VAL</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCT</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;code&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">CODE</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">CODE</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCT</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;storage&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nv">STORAGE</span><span class="p">:</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseMap</span><span class="p">({</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="p">}))</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The individual fields of the accounts are dealt with here.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;balance&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">BAL</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">       </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">       </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">       </span><span class="p">...</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>

<span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;code&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">CODE</span><span class="p">:</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">       </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">       </span><span class="nt">&lt;code&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">       </span><span class="p">...</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>

<span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;nonce&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">NONCE</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">       </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">       </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">       </span><span class="p">...</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>

<span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;storage&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">STORAGE</span><span class="p">:</span><span class="nv">Map</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">       </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">       </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">       </span><span class="p">...</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>Here we load the environmental information.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;env&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">VAL</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;currentTimestamp&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;currentGasLimit&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;currentNumber&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;currentDifficulty&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;env&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">VAL</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;currentCoinbase&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;previousHash&quot;</span><span class="p">))</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;env&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;currentCoinbase&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">CB</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">     </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;coinbase&gt;</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CB</span><span class="w">     </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;env&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;currentDifficulty&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">DIFF</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;difficulty&gt;</span><span class="w">   </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DIFF</span><span class="w">   </span><span class="nt">&lt;/difficulty&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;env&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;currentGasLimit&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">GLIMIT</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gasLimit&gt;</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nt">&lt;/gasLimit&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;env&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;currentNumber&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">NUM</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;number&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">NUM</span><span class="w">    </span><span class="nt">&lt;/number&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;env&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;previousHash&quot;</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">HASH</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;previousHash&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">HASH</span><span class="w">   </span><span class="nt">&lt;/previousHash&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;env&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;currentTimestamp&quot;</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">TS</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">     </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;timestamp&gt;</span><span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">TS</span><span class="w">     </span><span class="nt">&lt;/timestamp&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">VAL</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;gas&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;gasPrice&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">VAL</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;address&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;caller&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;origin&quot;</span><span class="p">))</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;gasPrice&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">GPRICE</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gasPrice&gt;</span><span class="w">  </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w">   </span><span class="nt">&lt;/gasPrice&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;gas&quot;</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">GAVAIL</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gas&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w">   </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;address&quot;</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCTTO</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;id&gt;</span><span class="w">        </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w">   </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;caller&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCTFROM</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;caller&gt;</span><span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/caller&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;gas&quot;</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">GAVAIL</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gas&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w">   </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;callValue&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="w">    </span><span class="nt">&lt;/callValue&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;origin&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">ORIG</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">     </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;origin&gt;</span><span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ORIG</span><span class="w">     </span><span class="nt">&lt;/origin&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;code&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">CODE</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">CODE</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">DATA</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">DATA</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="c1">// ------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">DATA</span><span class="p">:</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;code&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">CODE</span><span class="p">:</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;program&gt;</span><span class="w">  </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="p">(</span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="nv">CODE</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"> </span><span class="nt">&lt;programBytes&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nt">&lt;/programBytes&gt;</span><span class="w"> </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">&quot;network&quot;</span></code> key allows setting the fee schedule inside the test.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;network&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">SCHEDSTRING</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asScheduleString</span><span class="p">(</span><span class="nv">SCHEDSTRING</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#asScheduleString</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asScheduleString</span><span class="p">(</span><span class="s">&quot;EIP150&quot;</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asScheduleString</span><span class="p">(</span><span class="s">&quot;EIP158&quot;</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">EIP158</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asScheduleString</span><span class="p">(</span><span class="s">&quot;Frontier&quot;</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">FRONTIER</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asScheduleString</span><span class="p">(</span><span class="s">&quot;Homestead&quot;</span><span class="p">)</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">HOMESTEAD</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asScheduleString</span><span class="p">(</span><span class="s">&quot;Byzantium&quot;</span><span class="p">)</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BYZANTIUM</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asScheduleString</span><span class="p">(</span><span class="s">&quot;Constantinople&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CONSTANTINOPLE</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">&quot;rlp&quot;</span></code> key loads the block information.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;rlp&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpDecode</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">VAL</span><span class="p">))))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;genesisRLP&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpDecode</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">VAL</span><span class="p">))))</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;rlp&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">HP</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HO</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HC</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HR</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HB</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HD</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HI</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HG</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HM</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">HN</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">BT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">BU</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;transaction&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">BT</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;previousHash&gt;</span><span class="w">      </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HP</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/previousHash&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;ommersHash&gt;</span><span class="w">        </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HO</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/ommersHash&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;coinbase&gt;</span><span class="w">          </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HC</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;stateRoot&gt;</span><span class="w">         </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HR</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/stateRoot&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;transactionsRoot&gt;</span><span class="w">  </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HT</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/transactionsRoot&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;receiptsRoot&gt;</span><span class="w">      </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HE</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/receiptsRoot&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;logsBloom&gt;</span><span class="w">         </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HB</span><span class="p">)</span><span class="w">          </span><span class="nt">&lt;/logsBloom&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;difficulty&gt;</span><span class="w">        </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HD</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/difficulty&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;number&gt;</span><span class="w">            </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HI</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/number&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gasLimit&gt;</span><span class="w">          </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HL</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/gasLimit&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gasUsed&gt;</span><span class="w">           </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HG</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/gasUsed&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;timestamp&gt;</span><span class="w">         </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HS</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/timestamp&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;extraData&gt;</span><span class="w">         </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HX</span><span class="p">)</span><span class="w">          </span><span class="nt">&lt;/extraData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mixHash&gt;</span><span class="w">           </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HM</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/mixHash&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;blockNonce&gt;</span><span class="w">        </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HN</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/blockNonce&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;ommerBlockHeaders&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BU</span><span class="w">                              </span><span class="nt">&lt;/ommerBlockHeaders&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;genesisRLP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">HP</span><span class="p">,</span><span class="w"> </span><span class="nv">HO</span><span class="p">,</span><span class="w"> </span><span class="nv">HC</span><span class="p">,</span><span class="w"> </span><span class="nv">HR</span><span class="p">,</span><span class="w"> </span><span class="nv">HT</span><span class="p">,</span><span class="w"> </span><span class="nv">HE</span><span class="p">:</span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">HB</span><span class="p">,</span><span class="w"> </span><span class="nv">HD</span><span class="p">,</span><span class="w"> </span><span class="nv">HI</span><span class="p">,</span><span class="w"> </span><span class="nv">HL</span><span class="p">,</span><span class="w"> </span><span class="nv">HG</span><span class="p">,</span><span class="w"> </span><span class="nv">HS</span><span class="p">,</span><span class="w"> </span><span class="nv">HX</span><span class="p">,</span><span class="w"> </span><span class="nv">HM</span><span class="p">,</span><span class="w"> </span><span class="nv">HN</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">K</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;blockhash&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">#blockHeaderHash</span><span class="p">(</span><span class="nv">HP</span><span class="p">,</span><span class="w"> </span><span class="nv">HO</span><span class="p">,</span><span class="w"> </span><span class="nv">HC</span><span class="p">,</span><span class="w"> </span><span class="nv">HR</span><span class="p">,</span><span class="w"> </span><span class="nv">HT</span><span class="p">,</span><span class="w"> </span><span class="nv">HE</span><span class="p">,</span><span class="w"> </span><span class="nv">HB</span><span class="p">,</span><span class="w"> </span><span class="nv">HD</span><span class="p">,</span><span class="w"> </span><span class="nv">HI</span><span class="p">,</span><span class="w"> </span><span class="nv">HL</span><span class="p">,</span><span class="w"> </span><span class="nv">HG</span><span class="p">,</span><span class="w"> </span><span class="nv">HS</span><span class="p">,</span><span class="w"> </span><span class="nv">HX</span><span class="p">,</span><span class="w"> </span><span class="nv">HM</span><span class="p">,</span><span class="w"> </span><span class="nv">HN</span><span class="p">))</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HP</span><span class="p">)))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/blockhash&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="s">&quot;transaction&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">TN</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">TP</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">TG</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">TT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">TV</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">TI</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">TW</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">TR</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">TS</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txOrder&gt;</span><span class="w">   </span><span class="p">...</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="err">!</span><span class="nv">ID</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="err">!</span><span class="nv">ID</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;messages&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nv">Bag</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nt">&lt;message&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;msgID&gt;</span><span class="w">      </span><span class="err">!</span><span class="nv">ID</span><span class="p">:</span><span class="nv">Int</span><span class="w">                                 </span><span class="nt">&lt;/msgID&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;txNonce&gt;</span><span class="w">    </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">TN</span><span class="p">))</span><span class="w">         </span><span class="nt">&lt;/txNonce&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;txGasPrice&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">TP</span><span class="p">))</span><span class="w">         </span><span class="nt">&lt;/txGasPrice&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;txGasLimit&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">TG</span><span class="p">))</span><span class="w">         </span><span class="nt">&lt;/txGasLimit&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;to&gt;</span><span class="w">         </span><span class="nv">#asAccount</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">TT</span><span class="p">))</span><span class="w">      </span><span class="nt">&lt;/to&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;value&gt;</span><span class="w">      </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">TV</span><span class="p">))</span><span class="w">         </span><span class="nt">&lt;/value&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;v&gt;</span><span class="w">          </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">TW</span><span class="p">))</span><span class="w">         </span><span class="nt">&lt;/v&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;r&gt;</span><span class="w">          </span><span class="nv">#padToWidth</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">TR</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/r&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;s&gt;</span><span class="w">          </span><span class="nv">#padToWidth</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">TS</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/s&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;data&gt;</span><span class="w">       </span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">TI</span><span class="p">)</span><span class="w">                  </span><span class="nt">&lt;/data&gt;</span><span class="w"></span>
<span class="w">            </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/messages&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="checking-state">
<h2>Checking State<a class="headerlink" href="#checking-state" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">check_</span></code> checks if an account/transaction appears in the
world-state as stated.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumCommand</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;check&quot;</span><span class="w"> </span><span class="nv">JSON</span><span class="w"></span>
<span class="c1">// ---------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">J</span><span class="p">:</span><span class="nv">JSON</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">J</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">=/=</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;callcreates&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;transactions&quot;</span><span class="p">))</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">=/=</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;ommerHeaders&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">TEST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">TEST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">=/=</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">JS</span><span class="p">:</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sortJSONList</span><span class="p">(</span><span class="nv">JS</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;callcreates&quot;</span><span class="p">))</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">#isSorted</span><span class="p">(</span><span class="nv">JS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;post&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">POST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">POST</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCTID</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">((</span><span class="nv">ACCTID</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseAddr</span><span class="p">(</span><span class="nv">ACCTID</span><span class="p">))</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCT</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;balance&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">VAL</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCT</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;nonce&quot;</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">VAL</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCT</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;code&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">CODE</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">CODE</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCT</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;storage&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nv">STORAGE</span><span class="p">:</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseMap</span><span class="p">({</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="p">}))</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>


<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;balance&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">BAL</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;nonce&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">NONCE</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;storage&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">STORAGE</span><span class="p">:</span><span class="nv">Map</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="nv">ACCTSTORAGE</span><span class="w"> </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">#removeZeros</span><span class="p">(</span><span class="nv">ACCTSTORAGE</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;code&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">CODE</span><span class="p">:</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;code&gt;</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>Here we check the other post-conditions associated with an EVM test.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;out&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">OUT</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;out&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">OUT</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;out&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">OUT</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">OUT</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;out&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">OUT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;output&gt;</span><span class="w"> </span><span class="nv">OUT</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;logs&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">LOGS</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;logs&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">LOGS</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"></span>
<span class="c1">// ------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;logs&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">HASH</span><span class="p">:</span><span class="nv">String</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;log&gt;</span><span class="w"> </span><span class="nv">SL</span><span class="w"> </span><span class="nt">&lt;/log&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">#parseHexBytes</span><span class="p">(</span><span class="nv">Keccak256</span><span class="p">(</span><span class="nv">#rlpEncodeLogs</span><span class="p">(</span><span class="nv">SL</span><span class="p">)))</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">HASH</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#rlpEncodeLogs</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span><span class="w">        </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="nv">#rlpEncodeLogsAux</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span><span class="w">     </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="nv">#rlpEncodeTopics</span><span class="p">(</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeLogs</span><span class="p">(</span><span class="nv">SL</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">#rlpEncodeLogsAux</span><span class="p">(</span><span class="nv">SL</span><span class="p">),</span><span class="w"> </span><span class="mi">192</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeLogsAux</span><span class="p">(</span><span class="nv">ListItem</span><span class="p">({</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">TOPICS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nv">SL</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">#rlpEncodeTopics</span><span class="p">(</span><span class="nv">TOPICS</span><span class="p">),</span><span class="w"> </span><span class="mi">192</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeString</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">DATA</span><span class="p">)),</span><span class="w"> </span><span class="mi">192</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeLogsAux</span><span class="p">(</span><span class="nv">SL</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeLogsAux</span><span class="p">(.</span><span class="nv">List</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeTopics</span><span class="p">(</span><span class="nv">TOPIC</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">TOPICS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">TOPIC</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeTopics</span><span class="p">(</span><span class="nv">TOPICS</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeTopics</span><span class="p">(.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;gas&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">GLEFT</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;gas&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">GLEFT</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"></span>
<span class="c1">// ------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;gas&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nv">GLEFT</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">GLEFT</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;gas&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">GLEFT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GLEFT</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;callcreates&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">CCREATES</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;callcreates&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">CCREATES</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;callcreates&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">DATA</span><span class="p">:</span><span class="nv">String</span><span class="p">))</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;destination&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCTTO</span><span class="p">:</span><span class="nv">String</span><span class="p">))</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;gasLimit&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">GLIMIT</span><span class="p">:</span><span class="nv">String</span><span class="p">))</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VAL</span><span class="p">:</span><span class="nv">String</span><span class="p">))</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;callcreates&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">#parseAddr</span><span class="p">(</span><span class="nv">ACCTTO</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">GLIMIT</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">VAL</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">DATA</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;callcreates&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">C</span><span class="p">:</span><span class="nv">Call</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;callLog&gt;</span><span class="w"> </span><span class="nv">CL</span><span class="w"> </span><span class="nt">&lt;/callLog&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">CL</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">BLOCKHEADER</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">BLOCKHEADER</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="p">:</span><span class="nv">String</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">VALUE</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="p">:</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">VALUE</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;coinbase&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;difficulty&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;gasLimit&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;gasUsed&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                       </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;mixHash&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;nonce&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;number&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;parentHash&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                       </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;receiptTrie&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;stateRoot&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;timestamp&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                       </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;transactionsTrie&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;uncleHash&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;bloom&quot;</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;logsBloom&gt;</span><span class="w">        </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/logsBloom&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;coinbase&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;coinbase&gt;</span><span class="w">         </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;difficulty&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;difficulty&gt;</span><span class="w">       </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/difficulty&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;extraData&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;extraData&gt;</span><span class="w">        </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/extraData&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;gasLimit&quot;</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gasLimit&gt;</span><span class="w">         </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/gasLimit&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;gasUsed&quot;</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gasUsed&gt;</span><span class="w">          </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/gasUsed&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;mixHash&quot;</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;mixHash&gt;</span><span class="w">          </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/mixHash&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;nonce&quot;</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;blockNonce&gt;</span><span class="w">       </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/blockNonce&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;number&quot;</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;number&gt;</span><span class="w">           </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/number&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;parentHash&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;previousHash&gt;</span><span class="w">     </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/previousHash&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;receiptTrie&quot;</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;receiptsRoot&gt;</span><span class="w">     </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/receiptsRoot&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;stateRoot&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;stateRoot&gt;</span><span class="w">        </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/stateRoot&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;timestamp&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;timestamp&gt;</span><span class="w">        </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/timestamp&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;transactionsTrie&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;transactionsRoot&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/transactionsRoot&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;uncleHash&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;ommersHash&gt;</span><span class="w">       </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/ommersHash&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;blockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="nv">HASH</span><span class="p">:</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;previousHash&gt;</span><span class="w">     </span><span class="nv">HP</span><span class="w"> </span><span class="nt">&lt;/previousHash&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;ommersHash&gt;</span><span class="w">       </span><span class="nv">HO</span><span class="w"> </span><span class="nt">&lt;/ommersHash&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;coinbase&gt;</span><span class="w">         </span><span class="nv">HC</span><span class="w"> </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;stateRoot&gt;</span><span class="w">        </span><span class="nv">HR</span><span class="w"> </span><span class="nt">&lt;/stateRoot&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;transactionsRoot&gt;</span><span class="w"> </span><span class="nv">HT</span><span class="w"> </span><span class="nt">&lt;/transactionsRoot&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;receiptsRoot&gt;</span><span class="w">     </span><span class="nv">HE</span><span class="w"> </span><span class="nt">&lt;/receiptsRoot&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;logsBloom&gt;</span><span class="w">        </span><span class="nv">HB</span><span class="w"> </span><span class="nt">&lt;/logsBloom&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;difficulty&gt;</span><span class="w">       </span><span class="nv">HD</span><span class="w"> </span><span class="nt">&lt;/difficulty&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;number&gt;</span><span class="w">           </span><span class="nv">HI</span><span class="w"> </span><span class="nt">&lt;/number&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gasLimit&gt;</span><span class="w">         </span><span class="nv">HL</span><span class="w"> </span><span class="nt">&lt;/gasLimit&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gasUsed&gt;</span><span class="w">          </span><span class="nv">HG</span><span class="w"> </span><span class="nt">&lt;/gasUsed&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;timestamp&gt;</span><span class="w">        </span><span class="nv">HS</span><span class="w"> </span><span class="nt">&lt;/timestamp&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;extraData&gt;</span><span class="w">        </span><span class="nv">HX</span><span class="w"> </span><span class="nt">&lt;/extraData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mixHash&gt;</span><span class="w">          </span><span class="nv">HM</span><span class="w"> </span><span class="nt">&lt;/mixHash&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;blockNonce&gt;</span><span class="w">       </span><span class="nv">HN</span><span class="w"> </span><span class="nt">&lt;/blockNonce&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">#blockHeaderHash</span><span class="p">(</span><span class="nv">HP</span><span class="p">,</span><span class="w"> </span><span class="nv">HO</span><span class="p">,</span><span class="w"> </span><span class="nv">HC</span><span class="p">,</span><span class="w"> </span><span class="nv">HR</span><span class="p">,</span><span class="w"> </span><span class="nv">HT</span><span class="p">,</span><span class="w"> </span><span class="nv">HE</span><span class="p">,</span><span class="w"> </span><span class="nv">HB</span><span class="p">,</span><span class="w"> </span><span class="nv">HD</span><span class="p">,</span><span class="w"> </span><span class="nv">HI</span><span class="p">,</span><span class="w"> </span><span class="nv">HL</span><span class="p">,</span><span class="w"> </span><span class="nv">HG</span><span class="p">,</span><span class="w"> </span><span class="nv">HS</span><span class="p">,</span><span class="w"> </span><span class="nv">HX</span><span class="p">,</span><span class="w"> </span><span class="nv">HM</span><span class="p">,</span><span class="w"> </span><span class="nv">HN</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">HASH</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;genesisBlockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">BLOCKHEADER</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;genesisBlockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">BLOCKHEADER</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"></span>
<span class="c1">// ------------------------------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;genesisBlockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;genesisBlockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;genesisBlockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;genesisBlockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">K</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">=/=</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;hash&quot;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;genesisBlockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">HASH</span><span class="p">:</span><span class="nv">String</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">HASH</span><span class="p">)))</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;genesisBlockHeader&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="nv">HASH</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;blockhash&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">HASH</span><span class="p">)</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/blockhash&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">TRANSACTIONS</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">TRANSACTIONS</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">TRANSACTION</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">TRANSACTION</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="p">:</span><span class="nv">String</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">VALUE</span><span class="p">)))</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="p">:</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#padToWidth</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)))</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="o">==</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="o">==</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;s&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;to&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="p">:</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asAccount</span><span class="p">(</span><span class="nv">VALUE</span><span class="p">)))</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="p">:</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">VALUE</span><span class="p">)))</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;gasLimit&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;gasPrice&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;nonce&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                       </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"> </span><span class="nt">&lt;message&gt;</span><span class="w"> </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"> </span><span class="nt">&lt;data&gt;</span><span class="w">       </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/data&gt;</span><span class="w">       </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;gasLimit&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"> </span><span class="nt">&lt;message&gt;</span><span class="w"> </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"> </span><span class="nt">&lt;txGasLimit&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/txGasLimit&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;gasPrice&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"> </span><span class="nt">&lt;message&gt;</span><span class="w"> </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"> </span><span class="nt">&lt;txGasPrice&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/txGasPrice&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;nonce&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"> </span><span class="nt">&lt;message&gt;</span><span class="w"> </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"> </span><span class="nt">&lt;txNonce&gt;</span><span class="w">    </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/txNonce&gt;</span><span class="w">    </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;r&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"> </span><span class="nt">&lt;message&gt;</span><span class="w"> </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"> </span><span class="nt">&lt;r&gt;</span><span class="w">          </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/r&gt;</span><span class="w">          </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"> </span><span class="nt">&lt;message&gt;</span><span class="w"> </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"> </span><span class="nt">&lt;s&gt;</span><span class="w">          </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/s&gt;</span><span class="w">          </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;to&quot;</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"> </span><span class="nt">&lt;message&gt;</span><span class="w"> </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"> </span><span class="nt">&lt;to&gt;</span><span class="w">         </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/to&gt;</span><span class="w">         </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"> </span><span class="nt">&lt;message&gt;</span><span class="w"> </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"> </span><span class="nt">&lt;v&gt;</span><span class="w">          </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/v&gt;</span><span class="w">          </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;transactions&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;txOrder&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"> </span><span class="nt">&lt;message&gt;</span><span class="w"> </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"> </span><span class="nt">&lt;value&gt;</span><span class="w">      </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/value&gt;</span><span class="w">      </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>TODO: case with nonzero ommers.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;uncleHeaders&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">OMMERS</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;ommerHeaders&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">OMMERS</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="nv">TESTID</span><span class="w"></span>
<span class="w"> </span><span class="c1">// --------------------------------------------------------------------------------------------------</span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="s">&quot;ommerHeaders&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;ommerBlockHeaders&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nt">&lt;/ommerBlockHeaders&gt;</span><span class="w"></span>
<span class="nv">endmodule</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../verification/" class="btn btn-neutral float-right" title="KEVM Verification" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../evm/" class="btn btn-neutral" title="EVM Execution" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, The KEVM Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>