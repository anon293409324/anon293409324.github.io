

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>EVM Words &mdash; The EVM Jello Paper 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex/"/>
        <link rel="search" title="Search" href="../search/"/>
    <link rel="top" title="The EVM Jello Paper 0.1 documentation" href="../"/>
        <link rel="next" title="Analysis Tools" href="../analysis/"/>
        <link rel="prev" title="KEVM Verification" href="../verification/"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../" class="icon icon-home"> The EVM Jello Paper
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../evm/">EVM Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#evm-programs">EVM Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#precompiled-contracts">Precompiled Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#ethereum-gas-calculation">Ethereum Gas Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evm/#evm-program-representations">EVM Program Representations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ethereum/">Ethereum Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../verification/">KEVM Verification</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">EVM Words</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#primitives">Primitives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#empty-account">Empty Account</a></li>
<li class="toctree-l3"><a class="reference internal" href="#symbolic-words">Symbolic Words</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#arithmetic">Arithmetic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#comparison-operators">Comparison Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bitwise-operators">Bitwise Operators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#data-structures">Data Structures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#word-stack">Word Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="#byte-arrays">Byte Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="#addresses">Addresses</a></li>
<li class="toctree-l2"><a class="reference internal" href="#word-map">Word Map</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#parsing-unparsing">Parsing/Unparsing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#parsing">Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unparsing">Unparsing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#recursive-length-prefix-rlp">Recursive Length Prefix (RLP)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#encoding">Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#decoding">Decoding</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analysis/">Analysis Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../krypto/">Cryptographic Primitives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/">EVM Design Issues</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">The EVM Jello Paper</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../">Docs</a> &raquo;</li>
        
      <li>EVM Words</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/data.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="evm-words">
<h1>EVM Words<a class="headerlink" href="#evm-words" title="Permalink to this headline">¶</a></h1>
<p>EVM uses bounded 256 bit integer words, and sometimes also bytes (8 bit
words). Here we provide the arithmetic of these words, as well as some
data-structures over them. Both are implemented using K’s <code class="docutils literal"><span class="pre">Int</span></code>.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="nv">requires</span><span class="w"> </span><span class="s">&quot;krypto.k&quot;</span><span class="w"></span>
<span class="nv">requires</span><span class="w"> </span><span class="s">&quot;domains.k&quot;</span><span class="w"></span>

<span class="nv">module</span><span class="w"> </span><span class="nv">EVM</span><span class="err">-</span><span class="nv">DATA</span><span class="w"></span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="nv">KRYPTO</span><span class="w"></span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="nv">STRING</span><span class="err">-</span><span class="nv">BUFFER</span><span class="w"></span>

<span class="w">    </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">KResult</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
</pre></div>
</div>
<p>Some important numbers that are referred to often during execution:</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;pow256&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;pow255&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;pow16&quot;</span><span class="w">  </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">pow256</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">^</span><span class="nv">Int</span><span class="w"> </span><span class="mi">256</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">pow255</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">^</span><span class="nv">Int</span><span class="w"> </span><span class="mi">255</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">pow16</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">^</span><span class="nv">Int</span><span class="w"> </span><span class="mi">16</span><span class="w"></span>
</pre></div>
</div>
<p>The JSON format is used extensively for communication in the Ethereum
circles. Writing a JSON-ish parser in K takes 6 lines.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">List</span><span class="p">{</span><span class="nv">JSON</span><span class="p">,</span><span class="s">&quot;,&quot;</span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">JSONKey</span><span class="w">  </span><span class="p">::=</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">JSON</span><span class="w">     </span><span class="p">::=</span><span class="w"> </span><span class="nv">String</span><span class="w"></span>
<span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="nv">JSONKey</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="w"> </span><span class="nv">JSON</span><span class="w"></span>
<span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="s">&quot;}&quot;</span><span class="w"></span>
<span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------</span>
</pre></div>
</div>
<div class="section" id="primitives">
<h2>Primitives<a class="headerlink" href="#primitives" title="Permalink to this headline">¶</a></h2>
<p>Primitives provide the basic conversion from K’s sorts <code class="docutils literal"><span class="pre">Int</span></code> and
<code class="docutils literal"><span class="pre">Bool</span></code> to EVM’s words.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">chop</span></code> interperets an integers modulo .</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">chop</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">chop</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">I</span><span class="p">:</span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="nv">%Int</span><span class="w"> </span><span class="nv">pow256</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow256</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">chop</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">I</span><span class="p">:</span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">I</span><span class="w">             </span><span class="nv">requires</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow256</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">bool2Word</span></code> interperets a <code class="docutils literal"><span class="pre">Bool</span></code> as a <code class="docutils literal"><span class="pre">Int</span></code>.</li>
<li><code class="docutils literal"><span class="pre">word2Bool</span></code> interperets a <code class="docutils literal"><span class="pre">Int</span></code> as a <code class="docutils literal"><span class="pre">Bool</span></code>.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">bool2Word</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">bool2Word</span><span class="p">(</span><span class="nv">true</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">bool2Word</span><span class="p">(</span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">word2Bool</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">word2Bool</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">word2Bool</span><span class="p">(</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">true</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#ifInt_#then_#else_#fi</span></code> provides a conditional in <code class="docutils literal"><span class="pre">Int</span></code>
expressions.</li>
<li><code class="docutils literal"><span class="pre">#ifSet_#then_#else_#fi</span></code> provides a conditional in <code class="docutils literal"><span class="pre">Set</span></code>
expressions.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#ifInt&quot;</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="s">&quot;#then&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;#else&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;#fi&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">smtlib</span><span class="p">(</span><span class="nv">ite</span><span class="p">)]</span><span class="w"></span>
<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#ifSet&quot;</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="s">&quot;#then&quot;</span><span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="s">&quot;#else&quot;</span><span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="s">&quot;#fi&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------------------</span>
</pre></div>
</div>
<p>If we don’t place the <code class="docutils literal"><span class="pre">Bool</span></code> condition as a side-condition for UIUC-K,
it will attempt to only do an “implies-check” instead of full
unification (which is problematic when <code class="docutils literal"><span class="pre">B</span></code> is symbolic during
proving).</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="kd">rule</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">B</span><span class="w"></span>
<span class="kd">rule</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">B</span><span class="w"></span>

<span class="kd">rule</span><span class="w"> </span><span class="nv">#ifSet</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">B</span><span class="w"></span>
<span class="kd">rule</span><span class="w"> </span><span class="nv">#ifSet</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">B</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="kd">rule</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">[</span><span class="nv">macro</span><span class="p">]</span><span class="w"></span>
<span class="kd">rule</span><span class="w"> </span><span class="nv">#ifSet</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">[</span><span class="nv">macro</span><span class="p">]</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sgn</span></code> gives the twos-complement interperetation of the sign of a
word.</li>
<li><code class="docutils literal"><span class="pre">abs</span></code> gives the twos-complement interperetation of the magnitude of
a word.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">sgn</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">abs</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow255</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow255</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">abs</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">-</span><span class="nv">Word</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">-1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">abs</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">I</span><span class="w">         </span><span class="nv">requires</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="empty-account">
<h3>Empty Account<a class="headerlink" href="#empty-account" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">.Account</span></code> represents the case when an account ID is referenced in
the yellowpaper, but the actual value of the account ID is the empty
set. This is used, for example, when referring to the destination of
a message which creates a new contract.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Account</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;.Account&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="symbolic-words">
<h3>Symbolic Words<a class="headerlink" href="#symbolic-words" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#symbolicWord</span></code> generates a fresh existentially-bound symbolic
word.</li>
</ul>
<p>Note: Comment out this block (remove the <code class="docutils literal"><span class="pre">k</span></code> tag) if using RV K.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#symbolicWord&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#symbolicWord</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="err">?</span><span class="nv">X</span><span class="p">:</span><span class="nv">Int</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="err">?</span><span class="nv">X</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="err">?</span><span class="nv">X</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow256</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="arithmetic">
<h2>Arithmetic<a class="headerlink" href="#arithmetic" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">up/Int</span></code> performs integer division but rounds up instead of down.</li>
</ul>
<p>NOTE: Here, we choose to add <code class="docutils literal"><span class="pre">I2</span> <span class="pre">-Int</span> <span class="pre">1</span></code> to the numerator beforing
doing the division to mimic the C++ implementation. You could
alternatively calculate <code class="docutils literal"><span class="pre">I1</span> <span class="pre">%Int</span> <span class="pre">I2</span></code>, then add one to the normal
integer division afterward depending on the result.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;up/Int&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">I1</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">I1</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">I1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">I1</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="nv">I2</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">I1</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">I2</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="nv">I2</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">I2</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">logNInt</span></code> returns the log base N (floored) of an integer.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">log2Int</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">log2Int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">log2Int</span><span class="p">(</span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">log2Int</span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">log256Int</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">log256Int</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">log2Int</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
</pre></div>
</div>
<p>The corresponding <code class="docutils literal"><span class="pre">&lt;op&gt;Word</span></code> operations automatically perform the
correct modulus for EVM words.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;+Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;*Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;-Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;/Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;%Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">+</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">-</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">-</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow256</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">*</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">/</span><span class="nv">Word</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">/</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">%Word</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">%Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">%Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
</pre></div>
</div>
<p>Care is needed for <code class="docutils literal"><span class="pre">^Word</span></code> to avoid big exponentiation.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;^Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">^</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="err">^</span><span class="nv">Word</span><span class="w"> </span><span class="p">(</span><span class="nv">W1</span><span class="w"> </span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="err">^</span><span class="nv">Word</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow16</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="nv">%Int</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">^</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="err">^</span><span class="nv">Word</span><span class="w"> </span><span class="p">(</span><span class="nv">W1</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="err">*</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow16</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="nv">%Int</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
</pre></div>
</div>
<p>RV-K has a more efficient power-modulus operator.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">^</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="err">^</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="nv">%Int</span><span class="w"> </span><span class="nv">pow256</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow16</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">^</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">^</span><span class="nv">%Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="nv">pow256</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow16</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">/sWord</span></code> and <code class="docutils literal"><span class="pre">%sWord</span></code> give the signed interperetations of <code class="docutils literal"><span class="pre">/Word</span></code>
and <code class="docutils literal"><span class="pre">%Word</span></code>.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;/sWord&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;%sWord&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">/</span><span class="nv">sWord</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sgnInterp</span><span class="p">(</span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">abs</span><span class="p">(</span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="err">/</span><span class="nv">Word</span><span class="w"> </span><span class="nv">abs</span><span class="p">(</span><span class="nv">W1</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">%sWord</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sgnInterp</span><span class="p">(</span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W0</span><span class="p">)</span><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="nv">abs</span><span class="p">(</span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="nv">%Word</span><span class="w"> </span><span class="nv">abs</span><span class="p">(</span><span class="nv">W1</span><span class="p">))</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#sgnInterp</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sgnInterp</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sgnInterp</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W1</span><span class="w">         </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sgnInterp</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">-</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="comparison-operators">
<h2>Comparison Operators<a class="headerlink" href="#comparison-operators" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">&lt;op&gt;Word</span></code> comparison operators automatically interperet the
<code class="docutils literal"><span class="pre">Bool</span></code> as a <code class="docutils literal"><span class="pre">Word</span></code>.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;&lt;Word&quot;</span><span class="w">  </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;&gt;Word&quot;</span><span class="w">  </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;&lt;=Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;&gt;=Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;==Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Word</span><span class="w">  </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w">   </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Word</span><span class="w">  </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w">  </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Word</span><span class="w">  </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w">   </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Word</span><span class="w">  </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w">  </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w">  </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w">   </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w">  </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w">   </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="o">==</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w">  </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="o">==</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">s&lt;Word</span></code> implements a less-than for <code class="docutils literal"><span class="pre">Word</span></code> (with signed
interperetation).</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;s&lt;Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">s</span><span class="err">&lt;</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w">           </span><span class="nv">requires</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">s</span><span class="err">&lt;</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">bool2Word</span><span class="p">(</span><span class="nv">false</span><span class="p">)</span><span class="w">      </span><span class="nv">requires</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">-1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">s</span><span class="err">&lt;</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">bool2Word</span><span class="p">(</span><span class="nv">true</span><span class="p">)</span><span class="w">       </span><span class="nv">requires</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">s</span><span class="err">&lt;</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">abs</span><span class="p">(</span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Word</span><span class="w"> </span><span class="nv">abs</span><span class="p">(</span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">sgn</span><span class="p">(</span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">-1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="bitwise-operators">
<h2>Bitwise Operators<a class="headerlink" href="#bitwise-operators" title="Permalink to this headline">¶</a></h2>
<p>Bitwise logical operators are lifted from the integer versions.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;~Word&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w">       </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|Word&quot;</span><span class="w">   </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;&amp;Word&quot;</span><span class="w">   </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;xorWord&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="err">~</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">xorInt</span><span class="w"> </span><span class="p">(</span><span class="nv">pow256</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="o">|</span><span class="nv">Word</span><span class="w">   </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="o">|</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&amp;</span><span class="nv">Word</span><span class="w">   </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&amp;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">xorWord</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">xorInt</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">bit</span></code> gets bit  (0 being MSB).</li>
<li><code class="docutils literal"><span class="pre">byte</span></code> gets byte  (0 being the MSB).</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">bit</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">byte</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">bit</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">256</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">byte</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">bit</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">255</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">N</span><span class="p">))</span><span class="w"> </span><span class="nv">%Int</span><span class="w"> </span><span class="mi">2</span><span class="w">                     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">256</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">byte</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">256</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span><span class="w"> </span><span class="nv">%Int</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#nBits</span></code> shifts in  ones from the right.</li>
<li><code class="docutils literal"><span class="pre">#nBytes</span></code> shifts in  bytes of ones from the right.</li>
<li><code class="docutils literal"><span class="pre">_&lt;&lt;Byte_</span></code> shifts an integer 8 bits to the left.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#nBits</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">#nBytes</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;&lt;&lt;Byte&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#nBits</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#nBytes</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#nBits</span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w">   </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="nv">Byte</span><span class="w"> </span><span class="nv">M</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">M</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">signextend(N,</span> <span class="pre">W)</span></code> sign-extends from byte  of  (0
being MSB).</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">signextend</span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">signextend</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">signextend</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nv">#nBytes</span><span class="p">(</span><span class="mi">31</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="nv">Byte</span><span class="w"> </span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w">         </span><span class="nv">word2Bool</span><span class="p">(</span><span class="nv">bit</span><span class="p">(</span><span class="mi">256</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="nv">W</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">signextend</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chop</span><span class="p">(</span><span class="w"> </span><span class="nv">#nBytes</span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">                      </span><span class="err">&amp;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">word2Bool</span><span class="p">(</span><span class="nv">bit</span><span class="p">(</span><span class="mi">256</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="nv">W</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">keccak</span></code> serves as a wrapper around the <code class="docutils literal"><span class="pre">Keccak256</span></code> in
<code class="docutils literal"><span class="pre">KRYPTO</span></code>.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">keccak</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">keccak</span><span class="p">(</span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">Keccak256</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-structures">
<h1>Data Structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">¶</a></h1>
<p>Several data-structures and operations over <code class="docutils literal"><span class="pre">Int</span></code> are useful to have
around.</p>
<div class="section" id="word-stack">
<h2>Word Stack<a class="headerlink" href="#word-stack" title="Permalink to this headline">¶</a></h2>
<p>EVM is a stack machine, and so needs a stack of words to operate on. The
stack and some standard operations over it are provided here. This stack
also serves as a cons-list, so we provide some standard cons-list
manipulation tools.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">[</span><span class="nv">flatPredicate</span><span class="p">]</span><span class="w"></span>
<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;.WordStack&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">_++_</span></code> acts as <code class="docutils literal"><span class="pre">WordStack</span></code> append.</li>
<li><code class="docutils literal"><span class="pre">#take(N</span> <span class="pre">,</span> <span class="pre">WS)</span></code> keeps the first  elements of a
<code class="docutils literal"><span class="pre">WordStack</span></code> (passing with zeros as needed).</li>
<li><code class="docutils literal"><span class="pre">#drop(N</span> <span class="pre">,</span> <span class="pre">WS)</span></code> removes the first  elements of a
<code class="docutils literal"><span class="pre">WordStack</span></code>.</li>
<li><code class="docutils literal"><span class="pre">WS</span> <span class="pre">[</span> <span class="pre">N</span> <span class="pre">..</span> <span class="pre">W</span> <span class="pre">]</span></code> access the range of <code class="docutils literal"><span class="pre">WS</span></code> beginning with <code class="docutils literal"><span class="pre">N</span></code> of
width <code class="docutils literal"><span class="pre">W</span></code>.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;++&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="err">++</span><span class="w"> </span><span class="nv">WS</span><span class="err">&#39;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="err">&#39;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">   </span><span class="err">++</span><span class="w"> </span><span class="nv">WS</span><span class="err">&#39;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">WS</span><span class="w"> </span><span class="err">++</span><span class="w"> </span><span class="nv">WS</span><span class="err">&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#take</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#take</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#take</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">#take</span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#take</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">))</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">#take</span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">         </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#drop</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#drop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#drop</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#drop</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">))</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#drop</span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;..&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#take</span><span class="p">(</span><span class="nv">WIDTH</span><span class="p">,</span><span class="w"> </span><span class="nv">#drop</span><span class="p">(</span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">WS</span> <span class="pre">[</span> <span class="pre">N</span> <span class="pre">]</span></code> accesses element  of .</li>
<li><code class="docutils literal"><span class="pre">WS</span> <span class="pre">[</span> <span class="pre">N</span> <span class="pre">:=</span> <span class="pre">W</span> <span class="pre">]</span></code> sets element  of  to 
(padding with zeros as needed).</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">   </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="p">(.</span><span class="nv">WordStack</span><span class="p">)[</span><span class="nv">N</span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">            </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">   </span><span class="p">[</span><span class="nv">N</span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="p">[</span><span class="nv">N</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;:=&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="p">(.</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">])</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">WS</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">])</span><span class="w">         </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#sizeWordStack</span></code> calculates the size of a <code class="docutils literal"><span class="pre">WordStack</span></code>.</li>
<li><code class="docutils literal"><span class="pre">_in_</span></code> determines if a <code class="docutils literal"><span class="pre">Int</span></code> occurs in a <code class="docutils literal"><span class="pre">WordStack</span></code>.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w">       </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">smtlib</span><span class="p">(</span><span class="nv">sizeWordStack</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">sizeWordStackAux</span><span class="p">),</span><span class="w"> </span><span class="nv">smtlib</span><span class="p">(</span><span class="nv">sizeWordStackAux</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">,</span><span class="w"> </span><span class="nv">SIZE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SIZE</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SIZE</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SIZE</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="nv">W</span><span class="err">&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">W</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="nv">orElseBool</span><span class="w"> </span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#padToWidth(N,</span> <span class="pre">WS)</span></code> makes sure that a <code class="docutils literal"><span class="pre">WordStack</span></code> is the correct
size.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#padToWidth</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#padToWidth</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w">                     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">N</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#padToWidth</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#padToWidth</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">N</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="byte-arrays">
<h2>Byte Arrays<a class="headerlink" href="#byte-arrays" title="Permalink to this headline">¶</a></h2>
<p>The local memory of execution is a byte-array (instead of a word-array).</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#asWord</span></code> will interperet a stack of bytes as a single word (with
MSB first).</li>
<li><code class="docutils literal"><span class="pre">#asAccount</span></code> will interpret a stack of bytes as a single account id
(with MSB first). Differs from <code class="docutils literal"><span class="pre">#asWord</span></code> only in that an empty
stack represents the empty account, not account zero.</li>
<li><code class="docutils literal"><span class="pre">#asByteStack</span></code> will split a single word up into a <code class="docutils literal"><span class="pre">WordStack</span></code>
where each word is a byte wide.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#asWord</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">smtlib</span><span class="p">(</span><span class="nv">asWord</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(((</span><span class="nv">W0</span><span class="w"> </span><span class="err">*</span><span class="nv">Word</span><span class="w"> </span><span class="mi">256</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Account</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#asAccount</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asAccount</span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Account</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asAccount</span><span class="p">(</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#asByteStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">             </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                      </span><span class="o">|</span><span class="w"> </span><span class="nv">#asByteStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#asByteStackAux</span><span class="p">),</span><span class="w"> </span><span class="nv">smtlib</span><span class="p">(</span><span class="nv">asByteStack</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asByteStack</span><span class="p">(</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asByteStack</span><span class="p">(</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asByteStack</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asByteStack</span><span class="p">(</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asByteStack</span><span class="p">(</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">%Int</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="addresses">
<h2>Addresses<a class="headerlink" href="#addresses" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#addr</span></code> turns an Ethereum word into the corresponding Ethereum
address (160 LSB).</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#addr</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ---------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#addr</span><span class="p">(</span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">%Word</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="err">^</span><span class="nv">Word</span><span class="w"> </span><span class="mi">160</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#newAddr</span></code> computes the address of a new account given the address
and nonce of the creating account.</li>
<li><code class="docutils literal"><span class="pre">#sender</span></code> computes the sender of the transaction from its data and
signature.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#newAddr</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#newAddr</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">NONCE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#addr</span><span class="p">(</span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">Keccak256</span><span class="p">(</span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeWord</span><span class="p">(</span><span class="nv">NONCE</span><span class="p">),</span><span class="w"> </span><span class="mi">192</span><span class="p">))))</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#sender</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Account</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">#sender</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w">                                         </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#senderAux</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">#sender</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w">                                                                 </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#senderAux2</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sender</span><span class="p">(</span><span class="nv">TN</span><span class="p">,</span><span class="w"> </span><span class="nv">TP</span><span class="p">,</span><span class="w"> </span><span class="nv">TG</span><span class="p">,</span><span class="w"> </span><span class="nv">TT</span><span class="p">,</span><span class="w"> </span><span class="nv">TV</span><span class="p">,</span><span class="w"> </span><span class="nv">DATA</span><span class="p">,</span><span class="w"> </span><span class="nv">TW</span><span class="p">,</span><span class="w"> </span><span class="nv">TR</span><span class="p">,</span><span class="w"> </span><span class="nv">TS</span><span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sender</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">#parseHexBytes</span><span class="p">(</span><span class="nv">Keccak256</span><span class="p">(</span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">#rlpEncodeWordStack</span><span class="p">(</span><span class="nv">TN</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">TP</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">TG</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeAccount</span><span class="p">(</span><span class="nv">TT</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeWord</span><span class="p">(</span><span class="nv">TV</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeString</span><span class="p">(</span><span class="nv">DATA</span><span class="p">),</span><span class="w"> </span><span class="mi">192</span><span class="p">)))),</span><span class="w"> </span><span class="nv">TW</span><span class="p">,</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">TR</span><span class="p">),</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">TS</span><span class="p">))</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sender</span><span class="p">(</span><span class="nv">HT</span><span class="p">,</span><span class="w"> </span><span class="nv">TW</span><span class="p">,</span><span class="w"> </span><span class="nv">TR</span><span class="p">,</span><span class="w"> </span><span class="nv">TS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sender</span><span class="p">(</span><span class="nv">ECDSARecover</span><span class="p">(</span><span class="nv">HT</span><span class="p">,</span><span class="w"> </span><span class="nv">TW</span><span class="p">,</span><span class="w"> </span><span class="nv">TR</span><span class="p">,</span><span class="w"> </span><span class="nv">TS</span><span class="p">))</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sender</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Account</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#sender</span><span class="p">(</span><span class="nv">STR</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#addr</span><span class="p">(</span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">Keccak256</span><span class="p">(</span><span class="nv">STR</span><span class="p">)))</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">STR</span><span class="w"> </span><span class="p">=/=</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#blockHeaderHash</span></code> computes the hash of a block header given all
the block data.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#blockHeaderHash</span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">#blockHeaderHash</span><span class="p">(</span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#blockHashHeaderStr</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#blockHeaderHash</span><span class="p">(</span><span class="nv">HP</span><span class="p">,</span><span class="w"> </span><span class="nv">HO</span><span class="p">,</span><span class="w"> </span><span class="nv">HC</span><span class="p">,</span><span class="w"> </span><span class="nv">HR</span><span class="p">,</span><span class="w"> </span><span class="nv">HT</span><span class="p">,</span><span class="w"> </span><span class="nv">HE</span><span class="p">,</span><span class="w"> </span><span class="nv">HB</span><span class="p">,</span><span class="w"> </span><span class="nv">HD</span><span class="p">,</span><span class="w"> </span><span class="nv">HI</span><span class="p">,</span><span class="w"> </span><span class="nv">HL</span><span class="p">,</span><span class="w"> </span><span class="nv">HG</span><span class="p">,</span><span class="w"> </span><span class="nv">HS</span><span class="p">,</span><span class="w"> </span><span class="nv">HX</span><span class="p">,</span><span class="w"> </span><span class="nv">HM</span><span class="p">,</span><span class="w"> </span><span class="nv">HN</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#blockHeaderHash</span><span class="p">(</span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HP</span><span class="p">)),</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HO</span><span class="p">)),</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HC</span><span class="p">)),</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HR</span><span class="p">)),</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HT</span><span class="p">)),</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HE</span><span class="p">)),</span><span class="w"></span>
<span class="w">                                    </span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HB</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HD</span><span class="p">)),</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HI</span><span class="p">)),</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HL</span><span class="p">)),</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HG</span><span class="p">)),</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HS</span><span class="p">)),</span><span class="w"></span>
<span class="w">                                    </span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HX</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HM</span><span class="p">)),</span><span class="w"></span>
<span class="w">                            </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">HN</span><span class="p">)))</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#blockHeaderHash</span><span class="p">(</span><span class="nv">HP</span><span class="p">,</span><span class="w"> </span><span class="nv">HO</span><span class="p">,</span><span class="w"> </span><span class="nv">HC</span><span class="p">,</span><span class="w"> </span><span class="nv">HR</span><span class="p">,</span><span class="w"> </span><span class="nv">HT</span><span class="p">,</span><span class="w"> </span><span class="nv">HE</span><span class="p">,</span><span class="w"> </span><span class="nv">HB</span><span class="p">,</span><span class="w"> </span><span class="nv">HD</span><span class="p">,</span><span class="w"> </span><span class="nv">HI</span><span class="p">,</span><span class="w"> </span><span class="nv">HL</span><span class="p">,</span><span class="w"> </span><span class="nv">HG</span><span class="p">,</span><span class="w"> </span><span class="nv">HS</span><span class="p">,</span><span class="w"> </span><span class="nv">HX</span><span class="p">,</span><span class="w"> </span><span class="nv">HM</span><span class="p">,</span><span class="w"> </span><span class="nv">HN</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">Keccak256</span><span class="p">(</span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="w">         </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">HP</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                     </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">HO</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                     </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">HC</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                     </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">HR</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                     </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">HT</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                     </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">HE</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                     </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeString</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">HB</span><span class="p">))</span><span class="w"></span>
<span class="w">                                                     </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeWordStack</span><span class="p">(</span><span class="nv">HD</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">HI</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">HL</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">HG</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">HS</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                     </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeString</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">HX</span><span class="p">))</span><span class="w"></span>
<span class="w">                                                     </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">HM</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                     </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">HN</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"></span>
<span class="w">                                                   </span><span class="mi">192</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="word-map">
<h2>Word Map<a class="headerlink" href="#word-map" title="Permalink to this headline">¶</a></h2>
<p>Most of EVM data is held in finite maps. We are using the polymorphic
<code class="docutils literal"><span class="pre">Map</span></code> sort for these word maps.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">WM</span> <span class="pre">[</span> <span class="pre">N</span> <span class="pre">:=</span> <span class="pre">WS</span> <span class="pre">]</span></code> assigns a contiguous chunk of  to
 starting at position .</li>
<li><code class="docutils literal"><span class="pre">#asMapWordStack</span></code> converts a <code class="docutils literal"><span class="pre">WordStack</span></code> to a <code class="docutils literal"><span class="pre">Map</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#range(M,</span> <span class="pre">START,</span> <span class="pre">WIDTH)</span></code> reads off  elements from
 beginning at position  (padding with zeros as
needed).</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;:=&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">WM</span><span class="p">[</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WM</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">WM</span><span class="p">[</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w">     </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">WM</span><span class="p">[</span><span class="nv">N</span><span class="w"> </span><span class="err">&lt;-</span><span class="w"> </span><span class="nv">W</span><span class="p">])[</span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">WS</span><span class="p">]</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#asMapWordStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asMapWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">:</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">]</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#range</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">            </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#range</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#rangeAux</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">WM</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">WM</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">WM</span><span class="p">,</span><span class="w">           </span><span class="k">END</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">     </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">WM</span><span class="p">,</span><span class="w">           </span><span class="k">END</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">WM</span><span class="p">,</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="p">(</span><span class="nv">WIDTH</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">WM</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="k">END</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="nv">WM</span><span class="p">,</span><span class="w"> </span><span class="k">END</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">WM</span><span class="p">,</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="p">(</span><span class="nv">WIDTH</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#removeZeros</span></code> removes any entries in a map with zero values.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#removeZeros</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#removeZeros</span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w"> </span><span class="p">)</span><span class="w">               </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#removeZeros</span><span class="p">(</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">     </span><span class="nv">REST</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#removeZeros</span><span class="p">(</span><span class="nv">REST</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#removeZeros</span><span class="p">(</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">#removeZeros</span><span class="p">(</span><span class="nv">REST</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#lookup</span></code> looks up a key in a map and returns 0 if the key doesn’t
exist, otherwise returning its value.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#lookup</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#lookup</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nv">KEY</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">VAL</span><span class="p">)</span><span class="w"> </span><span class="nv">M</span><span class="p">,</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">VAL</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#lookup</span><span class="p">(</span><span class="w">               </span><span class="nv">M</span><span class="p">,</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">M</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="parsing-unparsing">
<h1>Parsing/Unparsing<a class="headerlink" href="#parsing-unparsing" title="Permalink to this headline">¶</a></h1>
<p>The EVM test-sets are represented in JSON format with hex-encoding of
the data and programs. Here we provide some standard parser/unparser
functions for that format.</p>
<div class="section" id="parsing">
<h2>Parsing<a class="headerlink" href="#parsing" title="Permalink to this headline">¶</a></h2>
<p>These parsers can interperet hex-encoded strings as <code class="docutils literal"><span class="pre">Int</span></code>s,
<code class="docutils literal"><span class="pre">WordStack</span></code>s, and <code class="docutils literal"><span class="pre">Map</span></code>s.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#parseHexWord</span></code> interperets a string as a single hex-encoded
<code class="docutils literal"><span class="pre">Word</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#parseHexBytes</span></code> interperets a string as a hex-encoded stack of
bytes.</li>
<li><code class="docutils literal"><span class="pre">#parseByteStack</span></code> interperets a string as a hex-encoded stack of
bytes, but makes sure to remove the leading “0x”.</li>
<li><code class="docutils literal"><span class="pre">#parseByteStackRaw</span></code> inteprets a string as a stack of bytes.</li>
<li><code class="docutils literal"><span class="pre">#parseWordStack</span></code> interperets a JSON list as a stack of <code class="docutils literal"><span class="pre">Word</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#parseMap</span></code> interperets a JSON key/value object as a map from
<code class="docutils literal"><span class="pre">Word</span></code> to <code class="docutils literal"><span class="pre">Word</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#parseAddr</span></code> interperets a string as a 160 bit hex-endcoded
address.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">#parseWord</span><span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="s">&quot;0x&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">String2Base</span><span class="p">(</span><span class="nv">replaceAll</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="p">(</span><span class="nv">S</span><span class="w"> </span><span class="p">=/=</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="p">(</span><span class="nv">S</span><span class="w"> </span><span class="p">=/=</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;0x&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">substrString</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">String</span><span class="w"> </span><span class="s">&quot;0x&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseWord</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">String2Int</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">owise</span><span class="p">]</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#parseHexBytes</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                      </span><span class="o">|</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                      </span><span class="o">|</span><span class="w"> </span><span class="nv">#parseByteStackRaw</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseByteStack</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseHexBytes</span><span class="p">(</span><span class="nv">replaceAll</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseHexBytes</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseHexBytes</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">substrString</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">#parseHexBytes</span><span class="p">(</span><span class="nv">substrString</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">S</span><span class="p">)))</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ordChar</span><span class="p">(</span><span class="nv">substrString</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">substrString</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">S</span><span class="p">)))</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#parseWordStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">JSON</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseWordStack</span><span class="p">(</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="w">            </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseWordStack</span><span class="p">(</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">(</span><span class="nv">WORD</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">WORD</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">#parseWordStack</span><span class="p">(</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#parseMap</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">JSON</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseMap</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w">                   </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseMap</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">_</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseMap</span><span class="p">({</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">})</span><span class="w">                                                </span><span class="nv">requires</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseMap</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">KEY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="p">:</span><span class="nv">String</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseMap</span><span class="p">({</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">KEY</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;-</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#parseAddr</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#parseAddr</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#addr</span><span class="p">(</span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">S</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="unparsing">
<h2>Unparsing<a class="headerlink" href="#unparsing" title="Permalink to this headline">¶</a></h2>
<p>We need to interperet a <code class="docutils literal"><span class="pre">WordStack</span></code> as a <code class="docutils literal"><span class="pre">String</span></code> again so that we
can call <code class="docutils literal"><span class="pre">Keccak256</span></code> on it from <code class="docutils literal"><span class="pre">KRYPTO</span></code>.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#unparseByteStack</span></code> turns a stack of bytes (as a <code class="docutils literal"><span class="pre">WordStack</span></code>)
into a <code class="docutils literal"><span class="pre">String</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#padByte</span></code> ensures that the <code class="docutils literal"><span class="pre">String</span></code> interperetation of a <code class="docutils literal"><span class="pre">Int</span></code>
is wide enough.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w">                </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">StringBuffer</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#unparseByteStackAux</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">StringBuffer</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">,</span><span class="w"> </span><span class="nv">BUFFER</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">StringBuffer2String</span><span class="p">(</span><span class="nv">BUFFER</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">BUFFER</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">BUFFER</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">chrChar</span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="nv">%Int</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="err">^</span><span class="nv">Int</span><span class="w"> </span><span class="mi">8</span><span class="p">)))</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#padByte</span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#padByte</span><span class="p">(</span><span class="w"> </span><span class="nv">S</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">S</span><span class="w">             </span><span class="nv">requires</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#padByte</span><span class="p">(</span><span class="w"> </span><span class="nv">S</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">S</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="recursive-length-prefix-rlp">
<h1>Recursive Length Prefix (RLP)<a class="headerlink" href="#recursive-length-prefix-rlp" title="Permalink to this headline">¶</a></h1>
<p>RLP encoding is used extensively for executing the blocks of a
transaction. For details about RLP encoding, see the <a class="reference external" href="http://gavwood.com/paper.pdf">YellowPaper
Appendix B</a>.</p>
<div class="section" id="encoding">
<h2>Encoding<a class="headerlink" href="#encoding" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#rlpEncodeWord</span></code> RLP encodes a single EVM word.</li>
<li><code class="docutils literal"><span class="pre">#rlpEncodeString</span></code> RLP encodes a single <code class="docutils literal"><span class="pre">String</span></code>.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#rlpEncodeWord</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">            </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="nv">#rlpEncodeWordStack</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="nv">#rlpEncodeString</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w">       </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="nv">#rlpEncodeAccount</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Account</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeWord</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;\x80&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeWord</span><span class="p">(</span><span class="nv">WORD</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chrChar</span><span class="p">(</span><span class="nv">WORD</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">WORD</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">WORD</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">128</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeWord</span><span class="p">(</span><span class="nv">WORD</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">#asByteStack</span><span class="p">(</span><span class="nv">WORD</span><span class="p">)),</span><span class="w"> </span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">WORD</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">128</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">WORD</span><span class="p">,</span><span class="w"> </span><span class="nv">LEN</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpEncodeString</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">#padToWidth</span><span class="p">(</span><span class="nv">LEN</span><span class="p">,</span><span class="w"> </span><span class="nv">#asByteStack</span><span class="p">(</span><span class="nv">WORD</span><span class="p">))))</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeWordStack</span><span class="p">(.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeWordStack</span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpEncodeWord</span><span class="p">(</span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">#rlpEncodeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeString</span><span class="p">(</span><span class="nv">STR</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">STR</span><span class="w">                        </span><span class="nv">requires</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">STR</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">ordChar</span><span class="p">(</span><span class="nv">STR</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">128</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeString</span><span class="p">(</span><span class="nv">STR</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">owise</span><span class="p">]</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeAccount</span><span class="p">(.</span><span class="nv">Account</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;\x80&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeAccount</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpEncodeBytes</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">Account</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">          </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#rlpEncodeLengthAux</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">OFFSET</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chrChar</span><span class="p">(</span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">STR</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">OFFSET</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">STR</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">STR</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">56</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">OFFSET</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">OFFSET</span><span class="p">,</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">#asByteStack</span><span class="p">(</span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">STR</span><span class="p">))))</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">STR</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">56</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpEncodeLength</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">OFFSET</span><span class="p">,</span><span class="w"> </span><span class="nv">BL</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">chrChar</span><span class="p">(</span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">BL</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">OFFSET</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">55</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">BL</span><span class="w"> </span><span class="err">+</span><span class="nv">String</span><span class="w"> </span><span class="nv">STR</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="decoding">
<h2>Decoding<a class="headerlink" href="#decoding" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#rlpDecode</span></code> RLP decodes a single <code class="docutils literal"><span class="pre">String</span></code> into a <code class="docutils literal"><span class="pre">JSON</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#rlpDecodeList</span></code> RLP decodes a single <code class="docutils literal"><span class="pre">String</span></code> into a
<code class="docutils literal"><span class="pre">JSONList</span></code>, interpereting the string as the RLP encoding of a list.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">JSON</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#rlpDecode</span><span class="p">(</span><span class="nv">String</span><span class="p">)</span><span class="w">               </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="nv">#rlpDecode</span><span class="p">(</span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">LengthPrefix</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#rlpDecodeAux</span><span class="p">)]</span><span class="w"></span>
<span class="w"> </span><span class="c1">// ----------------------------------------------------------------------------------</span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpDecode</span><span class="p">(</span><span class="nv">STR</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpDecode</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpDecode</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">#str</span><span class="p">(</span><span class="nv">LEN</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="p">))</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">substrString</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">LEN</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpDecode</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">#list</span><span class="p">(</span><span class="nv">LEN</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="p">))</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="nv">#rlpDecodeList</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="p">)]</span><span class="w"></span>

<span class="w">    </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">JSONList</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#rlpDecodeList</span><span class="p">(</span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="p">)</span><span class="w">               </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                      </span><span class="o">|</span><span class="w"> </span><span class="nv">#rlpDecodeList</span><span class="p">(</span><span class="nv">String</span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="p">,</span><span class="w"> </span><span class="nv">LengthPrefix</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#rlpDecodeListAux</span><span class="p">)]</span><span class="w"></span>
<span class="w"> </span><span class="c1">// ---------------------------------------------------------------------------------------------------</span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpDecodeList</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpDecodeList</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="p">,</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="p">))</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">POS</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">lengthString</span><span class="p">(</span><span class="nv">STR</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpDecodeList</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">[</span><span class="nv">owise</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#rlpDecodeList</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">:</span><span class="nv">LengthPrefixType</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span><span class="w"> </span><span class="nv">P</span><span class="p">))</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#rlpDecode</span><span class="p">(</span><span class="nv">substrString</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">POS</span><span class="p">,</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">P</span><span class="p">))</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">#rlpDecodeList</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">P</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">LengthPrefixType</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#str&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#list&quot;</span><span class="w"></span>
<span class="w">    </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">LengthPrefix</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">LengthPrefixType</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="w"></span>
<span class="w">                          </span><span class="o">|</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">                                </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                          </span><span class="o">|</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">                          </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#decodeLengthPrefixAux</span><span class="p">)]</span><span class="w"></span>
<span class="w">                          </span><span class="o">|</span><span class="w"> </span><span class="nv">#decodeLengthPrefixLength</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">LengthPrefixType</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                          </span><span class="o">|</span><span class="w"> </span><span class="nv">#decodeLengthPrefixLength</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">LengthPrefixType</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#decodeLengthPrefixLengthAux</span><span class="p">)]</span><span class="w"></span>
<span class="w"> </span><span class="c1">// --------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">ordChar</span><span class="p">(</span><span class="nv">substrString</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span><span class="w"></span>

<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#str</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">)</span><span class="w">                                   </span><span class="nv">requires</span><span class="w"> </span><span class="nv">B0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">128</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#str</span><span class="p">(</span><span class="nv">B0</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">                  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">B0</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">B0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">128</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">56</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#decodeLengthPrefixLength</span><span class="p">(</span><span class="nv">#str</span><span class="p">,</span><span class="w"> </span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="p">)</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">B0</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">128</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">56</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">B0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">192</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#list</span><span class="p">(</span><span class="nv">B0</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">192</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">                 </span><span class="nv">requires</span><span class="w"> </span><span class="nv">B0</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">192</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">B0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">192</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">56</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#decodeLengthPrefix</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#decodeLengthPrefixLength</span><span class="p">(</span><span class="nv">#list</span><span class="p">,</span><span class="w"> </span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">owise</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#decodeLengthPrefixLength</span><span class="p">(</span><span class="nv">#str</span><span class="p">,</span><span class="w">  </span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#decodeLengthPrefixLength</span><span class="p">(</span><span class="nv">#str</span><span class="p">,</span><span class="w">  </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">substrString</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">B0</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)))))</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#decodeLengthPrefixLength</span><span class="p">(</span><span class="nv">#list</span><span class="p">,</span><span class="w"> </span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#decodeLengthPrefixLength</span><span class="p">(</span><span class="nv">#list</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">B0</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">192</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#parseByteStackRaw</span><span class="p">(</span><span class="nv">substrString</span><span class="p">(</span><span class="nv">STR</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">B0</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">192</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)))))</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#decodeLengthPrefixLength</span><span class="p">(</span><span class="nv">TYPE</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">LL</span><span class="p">,</span><span class="w"> </span><span class="nv">L</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">TYPE</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">LL</span><span class="p">)</span><span class="w"></span>
<span class="nv">endmodule</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../analysis/" class="btn btn-neutral float-right" title="Analysis Tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../verification/" class="btn btn-neutral" title="KEVM Verification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, The KEVM Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>