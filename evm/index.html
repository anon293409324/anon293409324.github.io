

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>EVM Execution &mdash; The EVM Jello Paper 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex/"/>
        <link rel="search" title="Search" href="../search/"/>
    <link rel="top" title="The EVM Jello Paper 0.1 documentation" href="../"/>
        <link rel="next" title="Ethereum Simulations" href="../ethereum/"/>
        <link rel="prev" title="The EVM Jello Paper" href="../"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../" class="icon icon-home"> The EVM Jello Paper
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">EVM Execution</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modal-semantics">Modal Semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hardware">Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="#opcode-execution-cycle">OpCode Execution Cycle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exceptional-opcodes">Exceptional OpCodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#execution-step">Execution Step</a></li>
<li class="toctree-l3"><a class="reference internal" href="#program-counter">Program Counter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#substate-log">Substate Log</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#evm-programs">EVM Programs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#evm-opcodes">EVM OpCodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#internal-operations">Internal Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#invalid-operator">Invalid Operator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stack-manipulations">Stack Manipulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#local-memory">Local Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#expressions">Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#local-state">Local State</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jump"><code class="docutils literal"><span class="pre">JUMP*</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#stop-and-return"><code class="docutils literal"><span class="pre">STOP</span></code> and <code class="docutils literal"><span class="pre">RETURN</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#call-data">Call Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#log-operations">Log Operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ethereum-network-opcodes">Ethereum Network OpCodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#account-queries">Account Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#account-storage-operations">Account Storage Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#call-operations">Call Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#account-creation-deletion">Account Creation/Deletion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#precompiled-contracts">Precompiled Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="#ethereum-gas-calculation">Ethereum Gas Calculation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#memory-consumption">Memory Consumption</a></li>
<li class="toctree-l2"><a class="reference internal" href="#execution-gas">Execution Gas</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fee-schedule-from-c-implementation">Fee Schedule from C++ Implementation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#defualt-schedule">Defualt Schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frontier-schedule">Frontier Schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#homestead-schedule">Homestead Schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eip150-schedule">EIP150 Schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eip158-schedule">EIP158 Schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#byzantium-schedule">Byzantium Schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constantinople-schedule">Constantinople Schedule</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#evm-program-representations">EVM Program Representations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#disassembler">Disassembler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ethereum/">Ethereum Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../verification/">KEVM Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/">EVM Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/#data-structures">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/#parsing-unparsing">Parsing/Unparsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/#recursive-length-prefix-rlp">Recursive Length Prefix (RLP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis/">Analysis Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../krypto/">Cryptographic Primitives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/">EVM Design Issues</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">The EVM Jello Paper</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../">Docs</a> &raquo;</li>
        
      <li>EVM Execution</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/evm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="evm-execution">
<h1>EVM Execution<a class="headerlink" href="#evm-execution" title="Permalink to this headline">¶</a></h1>
<p>The EVM is a stack machine over some simple opcodes. Most of the opcodes
are “local” to the execution state of the machine, but some of them must
interact with the world state. This file only defines the local
execution operations, the file <code class="docutils literal"><span class="pre">ethereum.md</span></code> will define the
interactions with the world state.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="nv">requires</span><span class="w"> </span><span class="s">&quot;data.k&quot;</span><span class="w"></span>

<span class="nv">module</span><span class="w"> </span><span class="nv">EVM</span><span class="w"></span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="nv">STRING</span><span class="w"></span>
<span class="w">    </span><span class="nv">imports</span><span class="w"> </span><span class="nv">EVM</span><span class="err">-</span><span class="nv">DATA</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The configuration has cells for the current account id, the current
opcode, the program counter, the current gas, the gas price, the current
program, the word stack, and the local memory. In addition, there are
cells for the callstack and execution substate.</p>
<p>We’ve broken up the configuration into two components; those parts of
the state that mutate during execution of a single transaction and those
that are static throughout. In the comments next to each cell, we’ve
marked which component of the yellowpaper state corresponds to each
cell.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="nv">configuration</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">$PGM</span><span class="p">:</span><span class="nv">EthereumSimulation</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">              </span><span class="err">&lt;</span><span class="nv">exit</span><span class="err">-</span><span class="nv">code</span><span class="w"> </span><span class="nv">exit</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="err">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">&lt;/</span><span class="nv">exit</span><span class="err">-</span><span class="nv">code</span><span class="err">&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">$MODE</span><span class="p">:</span><span class="nv">Mode</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">$SCHEDULE</span><span class="p">:</span><span class="nv">Schedule</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;analysis&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w"> </span><span class="nt">&lt;/analysis&gt;</span><span class="w"></span>

<span class="w">              </span><span class="nt">&lt;ethereum&gt;</span><span class="w"></span>

<span class="w">                </span><span class="c1">// EVM Specific</span>
<span class="w">                </span><span class="c1">// ============</span>

<span class="w">                </span><span class="nt">&lt;evm&gt;</span><span class="w"></span>

<span class="w">                  </span><span class="c1">// Mutable during a single transaction</span>
<span class="w">                  </span><span class="c1">// -----------------------------------</span>

<span class="w">                  </span><span class="nt">&lt;output&gt;</span><span class="w">        </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w">              </span><span class="c1">// H_RETURN</span>
<span class="w">                  </span><span class="nt">&lt;memoryUsed&gt;</span><span class="w">    </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/memoryUsed&gt;</span><span class="w">          </span><span class="c1">// \mu_i</span>
<span class="w">                  </span><span class="nt">&lt;callDepth&gt;</span><span class="w">     </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&lt;callStack&gt;</span><span class="w">     </span><span class="p">.</span><span class="nv">List</span><span class="w">      </span><span class="nt">&lt;/callStack&gt;</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&lt;interimStates&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w">      </span><span class="nt">&lt;/interimStates&gt;</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&lt;substateStack&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w">      </span><span class="nt">&lt;/substateStack&gt;</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&lt;callLog&gt;</span><span class="w">       </span><span class="p">.</span><span class="nv">Set</span><span class="w">       </span><span class="nt">&lt;/callLog&gt;</span><span class="w"></span>

<span class="w">                  </span><span class="nt">&lt;txExecState&gt;</span><span class="w"></span>
<span class="w">                    </span><span class="nt">&lt;program&gt;</span><span class="w">      </span><span class="p">.</span><span class="nv">Map</span><span class="w">       </span><span class="nt">&lt;/program&gt;</span><span class="w">            </span><span class="c1">// I_b</span>
<span class="w">                    </span><span class="nt">&lt;programBytes&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/programBytes&gt;</span><span class="w"></span>

<span class="w">                    </span><span class="c1">// I_*</span>
<span class="w">                    </span><span class="nt">&lt;id&gt;</span><span class="w">        </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/id&gt;</span><span class="w">                    </span><span class="c1">// I_a</span>
<span class="w">                    </span><span class="nt">&lt;caller&gt;</span><span class="w">    </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/caller&gt;</span><span class="w">                </span><span class="c1">// I_s</span>
<span class="w">                    </span><span class="nt">&lt;callData&gt;</span><span class="w">  </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w">              </span><span class="c1">// I_d</span>
<span class="w">                    </span><span class="nt">&lt;callValue&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/callValue&gt;</span><span class="w">             </span><span class="c1">// I_v</span>

<span class="w">                    </span><span class="c1">// \mu_*</span>
<span class="w">                    </span><span class="nt">&lt;wordStack&gt;</span><span class="w">   </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w">           </span><span class="c1">// \mu_s</span>
<span class="w">                    </span><span class="nt">&lt;localMem&gt;</span><span class="w">    </span><span class="p">.</span><span class="nv">Map</span><span class="w">       </span><span class="nt">&lt;/localMem&gt;</span><span class="w">            </span><span class="c1">// \mu_m</span>
<span class="w">                    </span><span class="nt">&lt;pc&gt;</span><span class="w">          </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/pc&gt;</span><span class="w">                  </span><span class="c1">// \mu_pc</span>
<span class="w">                    </span><span class="nt">&lt;gas&gt;</span><span class="w">         </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/gas&gt;</span><span class="w">                 </span><span class="c1">// \mu_g</span>
<span class="w">                    </span><span class="nt">&lt;previousGas&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/previousGas&gt;</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&lt;/txExecState&gt;</span><span class="w"></span>

<span class="w">                  </span><span class="c1">// A_* (execution substate)</span>
<span class="w">                  </span><span class="nt">&lt;substate&gt;</span><span class="w"></span>
<span class="w">                    </span><span class="nt">&lt;selfDestruct&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Set</span><span class="w">  </span><span class="nt">&lt;/selfDestruct&gt;</span><span class="w">            </span><span class="c1">// A_s</span>
<span class="w">                    </span><span class="nt">&lt;log&gt;</span><span class="w">          </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="nt">&lt;/log&gt;</span><span class="w">                     </span><span class="c1">// A_l</span>
<span class="w">                    </span><span class="nt">&lt;refund&gt;</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="nt">&lt;/refund&gt;</span><span class="w">                  </span><span class="c1">// A_r</span>
<span class="w">                  </span><span class="nt">&lt;/substate&gt;</span><span class="w"></span>

<span class="w">                  </span><span class="c1">// Immutable during a single transaction</span>
<span class="w">                  </span><span class="c1">// -------------------------------------</span>

<span class="w">                  </span><span class="nt">&lt;gasPrice&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nt">&lt;/gasPrice&gt;</span><span class="w">                          </span><span class="c1">// I_p</span>
<span class="w">                  </span><span class="nt">&lt;origin&gt;</span><span class="w">   </span><span class="mi">0</span><span class="w"> </span><span class="nt">&lt;/origin&gt;</span><span class="w">                            </span><span class="c1">// I_o</span>

<span class="w">                  </span><span class="c1">// I_H* (block information)</span>
<span class="w">                  </span><span class="nt">&lt;previousHash&gt;</span><span class="w">     </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/previousHash&gt;</span><span class="w">     </span><span class="c1">// I_Hp</span>
<span class="w">                  </span><span class="nt">&lt;ommersHash&gt;</span><span class="w">       </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/ommersHash&gt;</span><span class="w">       </span><span class="c1">// I_Ho</span>
<span class="w">                  </span><span class="nt">&lt;coinbase&gt;</span><span class="w">         </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/coinbase&gt;</span><span class="w">         </span><span class="c1">// I_Hc</span>
<span class="w">                  </span><span class="nt">&lt;stateRoot&gt;</span><span class="w">        </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/stateRoot&gt;</span><span class="w">        </span><span class="c1">// I_Hr</span>
<span class="w">                  </span><span class="nt">&lt;transactionsRoot&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/transactionsRoot&gt;</span><span class="w"> </span><span class="c1">// I_Ht</span>
<span class="w">                  </span><span class="nt">&lt;receiptsRoot&gt;</span><span class="w">     </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/receiptsRoot&gt;</span><span class="w">     </span><span class="c1">// I_He</span>
<span class="w">                  </span><span class="nt">&lt;logsBloom&gt;</span><span class="w">        </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/logsBloom&gt;</span><span class="w">        </span><span class="c1">// I_Hb</span>
<span class="w">                  </span><span class="nt">&lt;difficulty&gt;</span><span class="w">       </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/difficulty&gt;</span><span class="w">       </span><span class="c1">// I_Hd</span>
<span class="w">                  </span><span class="nt">&lt;number&gt;</span><span class="w">           </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/number&gt;</span><span class="w">           </span><span class="c1">// I_Hi</span>
<span class="w">                  </span><span class="nt">&lt;gasLimit&gt;</span><span class="w">         </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/gasLimit&gt;</span><span class="w">         </span><span class="c1">// I_Hl</span>
<span class="w">                  </span><span class="nt">&lt;gasUsed&gt;</span><span class="w">          </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/gasUsed&gt;</span><span class="w">          </span><span class="c1">// I_Hg</span>
<span class="w">                  </span><span class="nt">&lt;timestamp&gt;</span><span class="w">        </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/timestamp&gt;</span><span class="w">        </span><span class="c1">// I_Hs</span>
<span class="w">                  </span><span class="nt">&lt;extraData&gt;</span><span class="w">        </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/extraData&gt;</span><span class="w">        </span><span class="c1">// I_Hx</span>
<span class="w">                  </span><span class="nt">&lt;mixHash&gt;</span><span class="w">          </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/mixHash&gt;</span><span class="w">          </span><span class="c1">// I_Hm</span>
<span class="w">                  </span><span class="nt">&lt;blockNonce&gt;</span><span class="w">       </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/blockNonce&gt;</span><span class="w">       </span><span class="c1">// I_Hn</span>

<span class="w">                  </span><span class="nt">&lt;ommerBlockHeaders&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">.</span><span class="nv">JSONList</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nt">&lt;/ommerBlockHeaders&gt;</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&lt;blockhash&gt;</span><span class="w">         </span><span class="p">.</span><span class="nv">List</span><span class="w">         </span><span class="nt">&lt;/blockhash&gt;</span><span class="w"></span>

<span class="w">                </span><span class="nt">&lt;/evm&gt;</span><span class="w"></span>

<span class="w">                </span><span class="c1">// Ethereum Network</span>
<span class="w">                </span><span class="c1">// ================</span>

<span class="w">                </span><span class="nt">&lt;network&gt;</span><span class="w"></span>

<span class="w">                  </span><span class="c1">// Accounts Record</span>
<span class="w">                  </span><span class="c1">// ---------------</span>

<span class="w">                  </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">                  </span><span class="nt">&lt;accounts&gt;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li>UIUC-K and RV-K have slight differences of opinion here.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="err">&lt;</span><span class="nv">account</span><span class="w"> </span><span class="nv">multiplicity</span><span class="o">=</span><span class="s">&quot;*&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s">&quot;Bag&quot;</span><span class="err">&gt;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="err">&lt;</span><span class="nv">account</span><span class="w"> </span><span class="nv">multiplicity</span><span class="o">=</span><span class="s">&quot;*&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s">&quot;Map&quot;</span><span class="err">&gt;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nt">&lt;acctID&gt;</span><span class="w">  </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nt">&lt;code&gt;</span><span class="w">    </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w">       </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nt">&lt;nonce&gt;</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">  </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="nt">&lt;/accounts&gt;</span><span class="w"></span>

<span class="c1">// Transactions Record</span>
<span class="c1">// -------------------</span>

<span class="nt">&lt;txOrder&gt;</span><span class="w">   </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="nt">&lt;/txOrder&gt;</span><span class="w"></span>
<span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>

<span class="nt">&lt;messages&gt;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li>UIUC-K and RV-K have slight differences of opinion here.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="err">&lt;</span><span class="nv">message</span><span class="w"> </span><span class="nv">multiplicity</span><span class="o">=</span><span class="s">&quot;*&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s">&quot;Bag&quot;</span><span class="err">&gt;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="err">&lt;</span><span class="nv">message</span><span class="w"> </span><span class="nv">multiplicity</span><span class="o">=</span><span class="s">&quot;*&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s">&quot;Map&quot;</span><span class="err">&gt;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">                         </span><span class="nt">&lt;msgID&gt;</span><span class="w">      </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/msgID&gt;</span><span class="w"></span>
<span class="w">                         </span><span class="nt">&lt;txNonce&gt;</span><span class="w">    </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/txNonce&gt;</span><span class="w">            </span><span class="c1">// T_n</span>
<span class="w">                         </span><span class="nt">&lt;txGasPrice&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/txGasPrice&gt;</span><span class="w">         </span><span class="c1">// T_p</span>
<span class="w">                         </span><span class="nt">&lt;txGasLimit&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/txGasLimit&gt;</span><span class="w">         </span><span class="c1">// T_g</span>
<span class="w">                         </span><span class="nt">&lt;to&gt;</span><span class="w">         </span><span class="p">.</span><span class="nv">Account</span><span class="w">   </span><span class="nt">&lt;/to&gt;</span><span class="w">                 </span><span class="c1">// T_t</span>
<span class="w">                         </span><span class="nt">&lt;value&gt;</span><span class="w">      </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/value&gt;</span><span class="w">              </span><span class="c1">// T_v</span>
<span class="w">                         </span><span class="nt">&lt;v&gt;</span><span class="w">          </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/v&gt;</span><span class="w">                  </span><span class="c1">// T_w</span>
<span class="w">                         </span><span class="nt">&lt;r&gt;</span><span class="w">          </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/r&gt;</span><span class="w">                  </span><span class="c1">// T_r</span>
<span class="w">                         </span><span class="nt">&lt;s&gt;</span><span class="w">          </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/s&gt;</span><span class="w">                  </span><span class="c1">// T_s</span>
<span class="w">                         </span><span class="nt">&lt;data&gt;</span><span class="w">       </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/data&gt;</span><span class="w">               </span><span class="c1">// T_i/T_e</span>
<span class="w">                       </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">                     </span><span class="nt">&lt;/messages&gt;</span><span class="w"></span>

<span class="w">                   </span><span class="nt">&lt;/network&gt;</span><span class="w"></span>

<span class="w">                 </span><span class="nt">&lt;/ethereum&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">EthereumSimulation</span><span class="w"></span>
<span class="c1">// -------------------------</span>
</pre></div>
</div>
</div>
<div class="section" id="modal-semantics">
<h2>Modal Semantics<a class="headerlink" href="#modal-semantics" title="Permalink to this headline">¶</a></h2>
<p>Our semantics is modal, with the initial mode being set on the command
line via <code class="docutils literal"><span class="pre">-cMODE=EXECMODE</span></code>.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">NORMAL</span></code> executes as a client on the network would.</li>
<li><code class="docutils literal"><span class="pre">VMTESTS</span></code> skips <code class="docutils literal"><span class="pre">CALL*</span></code> and <code class="docutils literal"><span class="pre">CREATE</span></code> operations.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Mode</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;NORMAL&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;VMTESTS&quot;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#setMode_</span></code> sets the mode to the supplied one.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Mode</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#setMode&quot;</span><span class="w"> </span><span class="nv">Mode</span><span class="w"></span>
<span class="c1">// -------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#setMode</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EX</span><span class="p">:</span><span class="nv">Exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">#setMode</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="hardware">
<h2>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">callStack</span></code> cell stores a list of previous VM execution states.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#pushCallStack</span></code> saves a copy of VM execution state on the
<code class="docutils literal"><span class="pre">callStack</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#popCallStack</span></code> restores the top element of the <code class="docutils literal"><span class="pre">callStack</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#dropCallStack</span></code> removes the top element of the <code class="docutils literal"><span class="pre">callStack</span></code>.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">State</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;}&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------------------------------------------------------------------------------</span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#pushCallStack&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#pushCallStack</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callStack&gt;</span><span class="w">  </span><span class="p">(.</span><span class="nv">List</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">({</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">BYTES</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">CR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">CV</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">MUSED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">DEPTH</span><span class="w"> </span><span class="p">}))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/callStack&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w">           </span><span class="nv">ACCT</span><span class="w">   </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w">          </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;program&gt;</span><span class="w">      </span><span class="nv">PGM</span><span class="w">    </span><span class="nt">&lt;/program&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;programBytes&gt;</span><span class="w"> </span><span class="nv">BYTES</span><span class="w">  </span><span class="nt">&lt;/programBytes&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;caller&gt;</span><span class="w">       </span><span class="nv">CR</span><span class="w">     </span><span class="nt">&lt;/caller&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w">     </span><span class="nv">CD</span><span class="w">     </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callValue&gt;</span><span class="w">    </span><span class="nv">CV</span><span class="w">     </span><span class="nt">&lt;/callValue&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;wordStack&gt;</span><span class="w">    </span><span class="nv">WS</span><span class="w">     </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w">     </span><span class="nv">LM</span><span class="w">     </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;memoryUsed&gt;</span><span class="w">   </span><span class="nv">MUSED</span><span class="w">  </span><span class="nt">&lt;/memoryUsed&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;pc&gt;</span><span class="w">           </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w">    </span><span class="nv">DEPTH</span><span class="w">  </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#popCallStack&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callStack&gt;</span><span class="w">  </span><span class="p">(</span><span class="nv">ListItem</span><span class="p">({</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">BYTES</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">CR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">CV</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">MUSED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">DEPTH</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/callStack&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w">           </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w">   </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w">          </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;program&gt;</span><span class="w">      </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">PGM</span><span class="w">    </span><span class="nt">&lt;/program&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;programBytes&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BYTES</span><span class="w">  </span><span class="nt">&lt;/programBytes&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;caller&gt;</span><span class="w">       </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CR</span><span class="w">     </span><span class="nt">&lt;/caller&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w">     </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callValue&gt;</span><span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CV</span><span class="w">     </span><span class="nt">&lt;/callValue&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;wordStack&gt;</span><span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w">     </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w">     </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;memoryUsed&gt;</span><span class="w">   </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MUSED</span><span class="w">  </span><span class="nt">&lt;/memoryUsed&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;pc&gt;</span><span class="w">           </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w">    </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DEPTH</span><span class="w">  </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#dropCallStack&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#dropCallStack</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;callStack&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/callStack&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">interimStates</span></code> cell stores a list of previous world states.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#pushWorldState</span></code> stores a copy of the current accounts at the top
of the <code class="docutils literal"><span class="pre">interimStates</span></code> cell.</li>
<li><code class="docutils literal"><span class="pre">#popWorldState</span></code> restores the top element of the <code class="docutils literal"><span class="pre">interimStates</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#dropWorldState</span></code> removes the top element of the <code class="docutils literal"><span class="pre">interimStates</span></code>.</li>
</ul>
<p>We use slightly different rules for rv-k versus uiuc-k because uiuc-k
does not support storing configuration fragments. The semantics of these
two sets of rules are identical, however, the version rv-k uses is
substantially faster. We would use that version in both places if not
for technical limitations on the prover. In the long term, a new prover
will be built capable of supporting the same code in both versions of
the semantics.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Account</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="s">&quot;}&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------------------------------</span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#pushWorldState&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#pushWorldStateAux&quot;</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#pushAccount&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Bool</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#pushWorldState</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#pushWorldStateAux</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;interimStates&gt;</span><span class="w"> </span><span class="p">(.</span><span class="nv">List</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(.</span><span class="nv">Set</span><span class="p">))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/interimStates&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#pushWorldStateAux</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#pushWorldStateAux</span><span class="w"> </span><span class="p">((</span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">EMPTY</span><span class="p">)</span><span class="w"> </span><span class="nv">REST</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#pushAccount</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushWorldStateAux</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#pushAccount</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;interimStates&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">((.</span><span class="nv">Set</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">({</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">}))</span><span class="w"> </span><span class="nv">REST</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/interimStates&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;code&gt;</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#popWorldState&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#popWorldStateAux&quot;</span><span class="w"> </span><span class="nv">Set</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#popWorldState</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#popWorldStateAux</span><span class="w"> </span><span class="nv">PREVSTATE</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;interimStates&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">PREVSTATE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/interimStates&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;accounts&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Bag</span><span class="w"> </span><span class="nt">&lt;/accounts&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#popWorldStateAux</span><span class="w"> </span><span class="p">.</span><span class="nv">Set</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#popWorldStateAux</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nv">SetItem</span><span class="p">({</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Set</span><span class="p">)</span><span class="w"> </span><span class="nv">REST</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">(.</span><span class="nv">Map</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">EMPTY</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;accounts&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nv">Bag</span><span class="w"></span>
<span class="w">                  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">                       </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">                       </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">                       </span><span class="nt">&lt;code&gt;</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">                       </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">                       </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">                     </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">                   </span><span class="p">)</span><span class="w"></span>
<span class="w">                   </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/accounts&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#dropWorldState&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#dropWorldState</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;interimStates&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/interimStates&gt;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Accounts</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="nv">AccountsCell</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="s">&quot;}&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------------------</span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#pushWorldState&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#pushWorldState</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">K</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;accounts&gt;</span><span class="w"> </span><span class="nv">ACCTDATA</span><span class="w"> </span><span class="nt">&lt;/accounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;interimStates&gt;</span><span class="w"> </span><span class="p">(.</span><span class="nv">List</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">({</span><span class="w"> </span><span class="nt">&lt;accounts&gt;</span><span class="w"> </span><span class="nv">ACCTDATA</span><span class="w"> </span><span class="nt">&lt;/accounts&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="p">}))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/interimStates&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#popWorldState&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#popWorldState</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">K</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;interimStates&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">ListItem</span><span class="p">({</span><span class="w"> </span><span class="nt">&lt;accounts&gt;</span><span class="w"> </span><span class="nv">ACCTDATA</span><span class="w"> </span><span class="nt">&lt;/accounts&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/interimStates&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;accounts&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCTDATA</span><span class="w"> </span><span class="nt">&lt;/accounts&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#dropWorldState&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#dropWorldState</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;interimStates&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/interimStates&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">substateStack</span></code> cell stores a list of previous substate logs.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#pushSubstate</span></code> stores a copy of the current substate at the top of
the <code class="docutils literal"><span class="pre">substateStack</span></code> cell.</li>
<li><code class="docutils literal"><span class="pre">#popSubstate</span></code> restores the top element of the <code class="docutils literal"><span class="pre">substateStack</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#dropSubstate</span></code> removes the top element of the <code class="docutils literal"><span class="pre">substateStack</span></code>.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#pushSubstate&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#pushSubstate</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">K</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;substate&gt;</span><span class="w"> </span><span class="nv">SUBSTATE</span><span class="w"> </span><span class="nt">&lt;/substate&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;substateStack&gt;</span><span class="w"> </span><span class="p">(.</span><span class="nv">List</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nt">&lt;substate&gt;</span><span class="w"> </span><span class="nv">SUBSTATE</span><span class="w"> </span><span class="nt">&lt;/substate&gt;</span><span class="p">))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/substateStack&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#popSubstate&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#popSubstate</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">K</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;substate&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SUBSTATE</span><span class="w"> </span><span class="nt">&lt;/substate&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;substateStack&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">ListItem</span><span class="p">(</span><span class="nt">&lt;substate&gt;</span><span class="w"> </span><span class="nv">SUBSTATE</span><span class="w"> </span><span class="nt">&lt;/substate&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/substateStack&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#dropSubstate&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#dropSubstate</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">K</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;substateStack&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/substateStack&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>Simple commands controlling exceptions provide control-flow.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#end</span></code> is used to indicate the (non-exceptional) end of execution.</li>
<li><code class="docutils literal"><span class="pre">#exception</span></code> is used to indicate exceptional states (it consumes
any operations to be performed after it).</li>
<li><code class="docutils literal"><span class="pre">#?_:_?#</span></code> allows for branching control-flow; if it reaches the
front of the <code class="docutils literal"><span class="pre">op</span></code> cell it takes the first branch, if an exception
runs into it it takes the second branch.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">KItem</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Exception</span><span class="w"></span>
<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Exception</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#exception&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#end&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EX</span><span class="p">:</span><span class="nv">Exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">_</span><span class="p">:</span><span class="nv">Int</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EX</span><span class="p">:</span><span class="nv">Exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">_</span><span class="p">:</span><span class="nv">OpCode</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">KItem</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#?&quot;</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="s">&quot;?#&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w">                </span><span class="err">#?</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="err">?#</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">K</span><span class="w">         </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w">  </span><span class="err">#?</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="err">?#</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">K</span><span class="w">         </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w">       </span><span class="p">~&gt;</span><span class="w"> </span><span class="p">(</span><span class="err">#?</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="err">?#</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="opcode-execution-cycle">
<h2>OpCode Execution Cycle<a class="headerlink" href="#opcode-execution-cycle" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">OpCode</span></code> is broken into several subsorts for easier handling. Here all
<code class="docutils literal"><span class="pre">OpCode</span></code>s are subsorted into <code class="docutils literal"><span class="pre">KItem</span></code> (allowing sequentialization),
and the various sorts of opcodes are subsorted into <code class="docutils literal"><span class="pre">OpCode</span></code>.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">KItem</span><span class="w">  </span><span class="p">::=</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"></span>
<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">NullStackOp</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">TernStackOp</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">QuadStackOp</span><span class="w"></span>
<span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="nv">InvalidOp</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">StackOp</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">CallOp</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">CallSixOp</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">PushOp</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------------------------</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#execute</span></code> calls <code class="docutils literal"><span class="pre">#next</span></code> repeatedly until it recieves an <code class="docutils literal"><span class="pre">#end</span></code>
or <code class="docutils literal"><span class="pre">#exception</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#execTo</span></code> executes until the next opcode is one of the specified
ones.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">KItem</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#execute&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="p">(.</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#next</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#execute</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EX</span><span class="p">:</span><span class="nv">Exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">#execute</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.)</span><span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#execTo&quot;</span><span class="w"> </span><span class="nv">Set</span><span class="w"></span>
<span class="c1">// -----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="p">(.</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#next</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#execTo</span><span class="w"> </span><span class="nv">OPS</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">OP</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">OPS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#execTo</span><span class="w"> </span><span class="nv">OPS</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">OPS</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#execTo</span><span class="w"> </span><span class="nv">OPS</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">keys</span><span class="p">(</span><span class="nv">PGM</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Execution follows a simple cycle where first the state is checked for
exceptions, then if no exceptions will be thrown the opcode is run.</p>
<ul class="simple">
<li>Regardless of the mode, <code class="docutils literal"><span class="pre">#next</span></code> will throw <code class="docutils literal"><span class="pre">#end</span></code> or
<code class="docutils literal"><span class="pre">#exception</span></code> if the current program counter is not pointing at an
OpCode.</li>
</ul>
<p>TODO: I think on <code class="docutils literal"><span class="pre">#next</span></code> we are supposed to pretend it’s <code class="docutils literal"><span class="pre">STOP</span></code> if
it’s in the middle of the program somewhere but is invalid? I suppose
the semantics currently loads <code class="docutils literal"><span class="pre">INVALID</span></code> where <code class="docutils literal"><span class="pre">N</span></code> is the position in
the bytecode array.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#next&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#next</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">PCOUNT</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">PGM</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li>In <code class="docutils literal"><span class="pre">NORMAL</span></code> or <code class="docutils literal"><span class="pre">VMTESTS</span></code> mode, <code class="docutils literal"><span class="pre">#next</span></code> checks if the opcode is
exceptional, runs it if not, then increments the program counter.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#next</span><span class="w"></span>
<span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#pushCallStack</span><span class="w"></span>
<span class="w">      </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#exceptional</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#exec</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pc</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="p">~&gt;</span><span class="w"> </span><span class="err">#?</span><span class="w"> </span><span class="nv">#dropCallStack</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="err">?#</span><span class="w"></span>
<span class="w">     </span><span class="p">...</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"></span>
<span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="nv">SetItem</span><span class="p">(</span><span class="nv">NORMAL</span><span class="p">)</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="nv">VMTESTS</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="exceptional-opcodes">
<h3>Exceptional OpCodes<a class="headerlink" href="#exceptional-opcodes" title="Permalink to this headline">¶</a></h3>
<p>Some checks if an opcode will throw an exception are relatively quick
and done up front.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#exceptional?</span></code> checks if the operator is invalid and will not
cause <code class="docutils literal"><span class="pre">wordStack</span></code> size issues (this implements the function <code class="docutils literal"><span class="pre">Z</span></code>
in the yellowpaper, section 9.4.2).</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#exceptional?&quot;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exceptional</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#invalid</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#badJumpDest</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#invalid?</span></code> checks if it’s the designated invalid opcode.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#invalid?&quot;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#invalid</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">INVALID</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#invalid</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w">      </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w">          </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">isInvalidOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#stackNeeded?</span></code> checks that the stack will be not be
under/overflown.</li>
<li><code class="docutils literal"><span class="pre">#stackNeeded</span></code>, <code class="docutils literal"><span class="pre">#stackAdded</span></code>, and <code class="docutils literal"><span class="pre">#stackDelta</span></code> are helpers
for deciding <code class="docutils literal"><span class="pre">#stackNeeded?</span></code>.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#stackNeeded?&quot;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">#stackDelta</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1024</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">K</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="nv">orBool</span><span class="w">   </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">#stackDelta</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">))</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">NOP</span><span class="p">:</span><span class="nv">NullStackOp</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">UOP</span><span class="p">:</span><span class="nv">UnStackOp</span><span class="p">)</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">BOP</span><span class="p">:</span><span class="nv">BinStackOp</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">isLogOp</span><span class="p">(</span><span class="nv">BOP</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">TOP</span><span class="p">:</span><span class="nv">TernStackOp</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">QOP</span><span class="p">:</span><span class="nv">QuadStackOp</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">DUP</span><span class="p">(</span><span class="nv">N</span><span class="p">))</span><span class="w">          </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">N</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">SWAP</span><span class="p">(</span><span class="nv">N</span><span class="p">))</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">LOG</span><span class="p">(</span><span class="nv">N</span><span class="p">))</span><span class="w">          </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">DELEGATECALL</span><span class="p">)</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">COP</span><span class="p">:</span><span class="nv">CallOp</span><span class="p">)</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">COP</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">DELEGATECALL</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">CALLDATACOPY</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">CODECOPY</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">EXTCODECOPY</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">POP</span><span class="p">)</span><span class="w">          </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">MSTORE</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">MSTORE8</span><span class="p">)</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">SSTORE</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">JUMP</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">JUMPI</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">JUMPDEST</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">STOP</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">RETURN</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">SELFDESTRUCT</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="nv">_</span><span class="p">))</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">LOG</span><span class="p">(</span><span class="nv">_</span><span class="p">))</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">SWAP</span><span class="p">(</span><span class="nv">N</span><span class="p">))</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">N</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">DUP</span><span class="p">(</span><span class="nv">N</span><span class="p">))</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w">           </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">[</span><span class="nv">owise</span><span class="p">]</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#stackDelta</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#stackDelta</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#stackAdded</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">#stackNeeded</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#badJumpDest?</span></code> determines if the opcode will result in a bad jump
destination.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#badJumpDest?&quot;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#badJumpDest</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w">    </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">isJumpOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#badJumpDest</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w">    </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">DEST</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"> </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">JUMPDEST</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">isJumpOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#badJumpDest</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">JUMPI</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#badJumpDest</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">JUMP</span><span class="w">  </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="p">:</span><span class="w">     </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"> </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">JUMPDEST</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#badJumpDest</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">JUMPI</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"> </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">JUMPDEST</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#badJumpDest</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">JUMP</span><span class="w">  </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="p">:</span><span class="w">     </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"> </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">DEST</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">PGM</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#badJumpDest</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">JUMPI</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"> </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="p">(</span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">DEST</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">PGM</span><span class="p">)))</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="execution-step">
<h3>Execution Step<a class="headerlink" href="#execution-step" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#exec</span></code> will load the arguments of the opcode (it assumes
<code class="docutils literal"><span class="pre">#stackNeeded?</span></code> is accurate and has been called) and trigger the
subsequent operations.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#exec&quot;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exec</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#gas</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">isInternalOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">isNullStackOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">isPushOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Here we load the correct number of arguments from the <code class="docutils literal"><span class="pre">wordStack</span></code>
based on the sort of the opcode. Some of them require an argument to be
interpereted as an address (modulo 160 bits), so the <code class="docutils literal"><span class="pre">#addr?</span></code> function
performs that check.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="nv">TernStackOp</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="nv">QuadStackOp</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="c1">// -------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exec</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">UOP</span><span class="p">:</span><span class="nv">UnStackOp</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">UOP</span><span class="w"> </span><span class="nv">#addr</span><span class="err">?</span><span class="p">(</span><span class="nv">UOP</span><span class="p">,</span><span class="w"> </span><span class="nv">W0</span><span class="p">)</span><span class="w">          </span><span class="p">]</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w">                </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exec</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">BOP</span><span class="p">:</span><span class="nv">BinStackOp</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BOP</span><span class="w"> </span><span class="nv">#addr</span><span class="err">?</span><span class="p">(</span><span class="nv">BOP</span><span class="p">,</span><span class="w"> </span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="nv">W1</span><span class="w">       </span><span class="p">]</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w">           </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exec</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">TOP</span><span class="p">:</span><span class="nv">TernStackOp</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">TOP</span><span class="w"> </span><span class="nv">#addr</span><span class="err">?</span><span class="p">(</span><span class="nv">TOP</span><span class="p">,</span><span class="w"> </span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="nv">W2</span><span class="w">    </span><span class="p">]</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exec</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">QOP</span><span class="p">:</span><span class="nv">QuadStackOp</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">QOP</span><span class="w"> </span><span class="nv">#addr</span><span class="err">?</span><span class="p">(</span><span class="nv">QOP</span><span class="p">,</span><span class="w"> </span><span class="nv">W0</span><span class="p">)</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="nv">W2</span><span class="w"> </span><span class="nv">W3</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W3</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#addr?&quot;</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#addr</span><span class="err">?</span><span class="p">(</span><span class="nv">BALANCE</span><span class="p">,</span><span class="w">      </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#addr</span><span class="p">(</span><span class="nv">W</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#addr</span><span class="err">?</span><span class="p">(</span><span class="nv">EXTCODESIZE</span><span class="p">,</span><span class="w">  </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#addr</span><span class="p">(</span><span class="nv">W</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#addr</span><span class="err">?</span><span class="p">(</span><span class="nv">EXTCODECOPY</span><span class="p">,</span><span class="w">  </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#addr</span><span class="p">(</span><span class="nv">W</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#addr</span><span class="err">?</span><span class="p">(</span><span class="nv">SELFDESTRUCT</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#addr</span><span class="p">(</span><span class="nv">W</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#addr</span><span class="err">?</span><span class="p">(</span><span class="nv">OP</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w">           </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w">        </span><span class="nv">requires</span><span class="w"> </span><span class="p">(</span><span class="nv">OP</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">BALANCE</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="p">(</span><span class="nv">OP</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">EXTCODESIZE</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="p">(</span><span class="nv">OP</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">EXTCODECOPY</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="p">(</span><span class="nv">OP</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">SELFDESTRUCT</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">StackOp</span></code> is used for opcodes which require a large portion of the
stack.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">StackOp</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"></span>
<span class="c1">// ---------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exec</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">SO</span><span class="p">:</span><span class="nv">StackOp</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SO</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">CallOp</span></code> opcodes all interperet their second argument as an
address.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">CallSixOp</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w">     </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="nv">CallOp</span><span class="w">    </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exec</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">CSO</span><span class="p">:</span><span class="nv">CallSixOp</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CSO</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">#addr</span><span class="p">(</span><span class="nv">W1</span><span class="p">)</span><span class="w">    </span><span class="nv">W2</span><span class="w"> </span><span class="nv">W3</span><span class="w"> </span><span class="nv">W4</span><span class="w"> </span><span class="nv">W5</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W3</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W4</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W5</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exec</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">CO</span><span class="p">:</span><span class="nv">CallOp</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CO</span><span class="w">  </span><span class="nv">W0</span><span class="w"> </span><span class="nv">#addr</span><span class="p">(</span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="nv">W2</span><span class="w"> </span><span class="nv">W3</span><span class="w"> </span><span class="nv">W4</span><span class="w"> </span><span class="nv">W5</span><span class="w"> </span><span class="nv">W6</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W3</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W4</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W5</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">W6</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#gas</span></code> calculates how much gas this operation costs, and takes into
account the memory consumed.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#gas&quot;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#deductGas&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#deductMemory&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gas</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">OP</span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#deductMemory</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">OP</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#deductGas</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;memoryUsed&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="nt">&lt;/memoryUsed&gt;</span><span class="w"> </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="err">&#39;</span><span class="p">:</span><span class="nv">Int</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#deductMemory</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">MU</span><span class="err">&#39;</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow256</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="err">&#39;</span><span class="p">:</span><span class="nv">Int</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#deductMemory</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">Cmem</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Cmem</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="p">))</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#deductGas</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;memoryUsed&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="err">&#39;</span><span class="w"> </span><span class="nt">&lt;/memoryUsed&gt;</span><span class="w"> </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">MU</span><span class="err">&#39;</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">pow256</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">G</span><span class="p">:</span><span class="nv">Int</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#deductGas</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w">                  </span><span class="nt">&lt;/gas&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">G</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">G</span><span class="p">:</span><span class="nv">Int</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#deductGas</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w">          </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"> </span><span class="nt">&lt;previousGas&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/previousGas&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">G</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Cmem</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">memo</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cmem</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Gmemory</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">((</span><span class="nv">N</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Gquadcoeff</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="program-counter">
<h3>Program Counter<a class="headerlink" href="#program-counter" title="Permalink to this headline">¶</a></h3>
<p>All operators except for <code class="docutils literal"><span class="pre">PUSH</span></code> and <code class="docutils literal"><span class="pre">JUMP*</span></code> increment the program
counter by 1. The arguments to <code class="docutils literal"><span class="pre">PUSH</span></code> must be skipped over (as they
are inline), and the opcode <code class="docutils literal"><span class="pre">JUMP</span></code> already affects the program counter
in the correct way.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#pc</span></code> calculates the next program counter of the given operator.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#pc&quot;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#pc</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w">         </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w">          </span><span class="nt">&lt;/pc&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">isPushOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">isJumpOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#pc</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#pc</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">OP</span><span class="w">         </span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">isJumpOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">isJumpOp</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">isJumpOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">JUMP</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">JUMPI</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="substate-log">
<h3>Substate Log<a class="headerlink" href="#substate-log" title="Permalink to this headline">¶</a></h3>
<p>During execution of a transaction some things are recorded in the
substate log (Section 6.1 in yellowpaper). This is a right cons-list of
<code class="docutils literal"><span class="pre">SubstateLogEntry</span></code> (which contains the account ID along with the
specified portions of the <code class="docutils literal"><span class="pre">wordStack</span></code> and <code class="docutils literal"><span class="pre">localMem</span></code>).</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">SubstateLogEntry</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;}&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------------------------------------</span>
</pre></div>
</div>
<p>After executing a transaction, it’s necessary to have the effect of the
substate log recorded.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#finalizeTx</span></code> makes the substate log actually have an effect on the
state.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="c1">// ------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">true</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;selfDestruct&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Set</span><span class="w"> </span><span class="nt">&lt;/selfDestruct&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">false</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">true</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;refund&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nt">&lt;/refund&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">CURRBAL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CURRBAL</span><span class="w"> </span><span class="err">+</span><span class="nv">Word</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="p">(.</span><span class="nv">K</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">MINER</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">_</span><span class="p">)...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">NORMAL</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;coinbase&gt;</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">NORMAL</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">G</span><span class="err">*</span><span class="p">(</span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="p">,</span><span class="w"> </span><span class="nv">REFUND</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;refund&gt;</span><span class="w"> </span><span class="nv">REFUND</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nt">&lt;/refund&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">MSGID</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;message&gt;</span><span class="w"></span>
<span class="w">           </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">MSGID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"></span>
<span class="w">           </span><span class="nt">&lt;txGasLimit&gt;</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nt">&lt;/txGasLimit&gt;</span><span class="w"></span>
<span class="w">           </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">REFUND</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">false</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">true</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">NORMAL</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;origin&gt;</span><span class="w"> </span><span class="nv">ORG</span><span class="w"> </span><span class="nt">&lt;/origin&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;coinbase&gt;</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;refund&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nt">&lt;/refund&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ORG</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">ORGBAL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ORGBAL</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">MINBAL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MINBAL</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">GLIMIT</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">)</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">TXID</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;message&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">TXID</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txGasLimit&gt;</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nt">&lt;/txGasLimit&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txGasPrice&gt;</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="nt">&lt;/txGasPrice&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ORG</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">ORGEMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">ORGEMPTY</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="nv">MINER</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">MINEMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="p">(</span><span class="nv">GLIMIT</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">)</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">MINEMPTY</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">ORG</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">MINER</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">false</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">true</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">NORMAL</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;origin&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/origin&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;coinbase&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;refund&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nt">&lt;/refund&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;txPending&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">MsgId</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">List</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/txPending&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;message&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;msgID&gt;</span><span class="w"> </span><span class="nv">MsgId</span><span class="w"> </span><span class="nt">&lt;/msgID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txGasLimit&gt;</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nt">&lt;/txGasLimit&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;txGasPrice&gt;</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="nt">&lt;/txGasPrice&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/message&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#finalizeTx</span><span class="p">(</span><span class="nv">true</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;selfDestruct&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">(</span><span class="nv">SetItem</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Set</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/selfDestruct&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;accounts&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">              </span><span class="p">...</span><span class="w"></span>
<span class="w">            </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Bag</span><span class="w"></span>
<span class="w">          </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/accounts&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="evm-programs">
<h1>EVM Programs<a class="headerlink" href="#evm-programs" title="Permalink to this headline">¶</a></h1>
<p>Lists of opcodes form programs. Deciding if an opcode is in a list will
be useful for modeling gas, and converting a program into a map of
program-counter to opcode is useful for execution.</p>
<p>Note that <code class="docutils literal"><span class="pre">_in_</span></code> ignores the arguments to operators that are
parametric.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;.OpCodes&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="s">&quot;;&quot;</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"></span>
<span class="c1">// --------------------------------------------------</span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">)</span><span class="w">             </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#asMapOpCodesAux</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">OPS</span><span class="p">::</span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">OpCodes</span><span class="w">         </span><span class="p">,</span><span class="w"> </span><span class="nv">MAP</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MAP</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">OP</span><span class="p">:</span><span class="nv">OpCode</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="nv">OCS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">MAP</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">OCS</span><span class="p">,</span><span class="w"> </span><span class="nv">MAP</span><span class="w"> </span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">OP</span><span class="p">))</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">isPushOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">M</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nv">OCS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">MAP</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">M</span><span class="p">,</span><span class="w"> </span><span class="nv">OCS</span><span class="p">,</span><span class="w"> </span><span class="nv">MAP</span><span class="w"> </span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">M</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)))</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#asOpCodes</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">)</span><span class="w">                 </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="nv">#asOpCodes</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#asOpCodesAux</span><span class="p">)]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asOpCodes</span><span class="p">(</span><span class="nv">M</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asOpCodes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">M</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">OpCodes</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asOpCodes</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="p">,</span><span class="w">               </span><span class="nv">OPS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">OPS</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asOpCodes</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">OP</span><span class="w">         </span><span class="nv">M</span><span class="p">,</span><span class="w"> </span><span class="nv">OPS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asOpCodes</span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">        </span><span class="nv">M</span><span class="p">,</span><span class="w"> </span><span class="nv">OP</span><span class="w">         </span><span class="p">;</span><span class="w"> </span><span class="nv">OPS</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">isPushOp</span><span class="p">(</span><span class="nv">OP</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#asOpCodes</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="nv">M</span><span class="p">,</span><span class="w"> </span><span class="nv">OPS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asOpCodes</span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">S</span><span class="p">,</span><span class="w"> </span><span class="nv">M</span><span class="p">,</span><span class="w"> </span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nv">OPS</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="evm-opcodes">
<h2>EVM OpCodes<a class="headerlink" href="#evm-opcodes" title="Permalink to this headline">¶</a></h2>
<p>Each subsection has a different class of opcodes. Organization is based
roughly on what parts of the execution state are needed to compute the
result of each operator. This sometimes corresponds to the organization
in the yellowpaper.</p>
<div class="section" id="internal-operations">
<h3>Internal Operations<a class="headerlink" href="#internal-operations" title="Permalink to this headline">¶</a></h3>
<p>These are just used by the other operators for shuffling local execution
state around on the EVM.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#push</span></code> will push an element to the <code class="docutils literal"><span class="pre">wordStack</span></code> without any
checks.</li>
<li><code class="docutils literal"><span class="pre">#setStack_</span></code> will set the current stack to the given one.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#push&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#setStack&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="p">:</span><span class="nv">Int</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#setStack</span><span class="w"> </span><span class="nv">WS</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w">      </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#newAccount_</span></code> allows declaring a new empty account with the given
address (and assumes the rounding to 160 bits has already occured).
If the account already exists with non-zero nonce or non-empty code,
an exception is thrown. Otherwise, if the account already exists, the
storage is cleared.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#newAccount&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="c1">// ---------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w">  </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;code&gt;</span><span class="w">   </span><span class="nv">CODE</span><span class="w">  </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w">  </span><span class="nv">NONCE</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w">  </span><span class="nv">ACCT</span><span class="w">       </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;code&gt;</span><span class="w">    </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w">  </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="p">(.</span><span class="nv">Map</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">true</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;accounts&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nv">Bag</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;acctID&gt;</span><span class="w">  </span><span class="nv">ACCT</span><span class="w">       </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;code&gt;</span><span class="w">    </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w">       </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">              </span><span class="nt">&lt;nonce&gt;</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">            </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/accounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#transferFunds</span></code> moves money from one account into another,
creating the destination account if it doesn’t exist.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#transferFunds&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="c1">// --------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#transferFunds</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">ORIGFROM</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ORIGFROM</span><span class="w"> </span><span class="err">-</span><span class="nv">Word</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;code&gt;</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">ORIGTO</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ORIGTO</span><span class="w"> </span><span class="err">+</span><span class="nv">Word</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ORIGFROM</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">ORIGFROM</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#transferFunds</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">ORIGFROM</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">ORIGFROM</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="p">(.</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#transferFunds</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#transferFunds</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">ORIGFROM</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">ORIGFROM</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="invalid-operator">
<h3>Invalid Operator<a class="headerlink" href="#invalid-operator" title="Permalink to this headline">¶</a></h3>
<p>We use <code class="docutils literal"><span class="pre">INVALID</span></code> both for marking the designated invalid operator and
for garbage bytes in the input program.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InvalidOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;INVALID&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------</span>
</pre></div>
</div>
</div>
<div class="section" id="stack-manipulations">
<h3>Stack Manipulations<a class="headerlink" href="#stack-manipulations" title="Permalink to this headline">¶</a></h3>
<p>Some operators don’t calculate anything, they just push the stack around
a bit.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;POP&quot;</span><span class="w"></span>
<span class="c1">// --------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">POP</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">StackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">DUP</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">SWAP</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="c1">// ---------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">DUP</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span><span class="w">  </span><span class="nv">WS</span><span class="p">:</span><span class="nv">WordStack</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#setStack</span><span class="w"> </span><span class="p">((</span><span class="nv">WS</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">])</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">                      </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SWAP</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#setStack</span><span class="w"> </span><span class="p">((</span><span class="nv">WS</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">])</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nv">WS</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">]))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">PushOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">PUSH</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="c1">// ------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="local-memory">
<h3>Local Memory<a class="headerlink" href="#local-memory" title="Permalink to this headline">¶</a></h3>
<p>These operations are getters/setters of the local execution memory.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;MLOAD&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">MLOAD</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#range</span><span class="p">(</span><span class="nv">LM</span><span class="p">,</span><span class="w"> </span><span class="nv">INDEX</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;MSTORE&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;MSTORE8&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">MSTORE</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">#padToWidth</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="nv">#asByteStack</span><span class="p">(</span><span class="nv">VALUE</span><span class="p">))</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">MSTORE8</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="err">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">%Int</span><span class="w"> </span><span class="mi">256</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w">    </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="expressions">
<h3>Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h3>
<p>Expression calculations are simple and don’t require anything but the
arguments from the <code class="docutils literal"><span class="pre">wordStack</span></code> to operate.</p>
<p>NOTE: We have to call the opcode <code class="docutils literal"><span class="pre">OR</span></code> by <code class="docutils literal"><span class="pre">EVMOR</span></code> instead, because K
has trouble parsing it/compiling the definition otherwise.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;ISZERO&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;NOT&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">ISZERO</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w">        </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">ISZERO</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">        </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">NOT</span><span class="w">    </span><span class="nv">W</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="err">~</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W</span><span class="w">  </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;ADD&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;MUL&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;SUB&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;DIV&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;EXP&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;MOD&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">ADD</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">+</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">MUL</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">*</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SUB</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">-</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">DIV</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">/</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">^</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">MOD</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">%Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;SDIV&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;SMOD&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SDIV</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">/</span><span class="nv">sWord</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SMOD</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">%sWord</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">TernStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;ADDMOD&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;MULMOD&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">ADDMOD</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="nv">W2</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="nv">%Word</span><span class="w"> </span><span class="nv">W2</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">MULMOD</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="nv">W2</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">W0</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="nv">%Word</span><span class="w"> </span><span class="nv">W2</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;BYTE&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;SIGNEXTEND&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">BYTE</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="nv">W</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">byte</span><span class="p">(</span><span class="nv">INDEX</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="p">)</span><span class="w">     </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SIGNEXTEND</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">signextend</span><span class="p">(</span><span class="nv">W0</span><span class="p">,</span><span class="w"> </span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;AND&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;EVMOR&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;XOR&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">AND</span><span class="w">   </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&amp;</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w">   </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EVMOR</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="o">|</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w">   </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">XOR</span><span class="w">   </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">xorWord</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;LT&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;GT&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;EQ&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">LT</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w">   </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">LT</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w">  </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">GT</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w">   </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">GT</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w">  </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EQ</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w">  </span><span class="nv">W1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EQ</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w">  </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">W1</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;SLT&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;SGT&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SLT</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">s</span><span class="err">&lt;</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SGT</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="nv">s</span><span class="err">&lt;</span><span class="nv">Word</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;SHA3&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SHA3</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="w"> </span><span class="nv">MEMWIDTH</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">keccak</span><span class="p">(</span><span class="nv">#range</span><span class="p">(</span><span class="nv">LM</span><span class="p">,</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">MEMWIDTH</span><span class="p">))</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="local-state">
<h3>Local State<a class="headerlink" href="#local-state" title="Permalink to this headline">¶</a></h3>
<p>These operators make queries about the current execution state.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">NullStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;PC&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;GAS&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;GASPRICE&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;GASLIMIT&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">PC</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">GAS</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">GASPRICE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gasPrice&gt;</span><span class="w"> </span><span class="nv">GPRICE</span><span class="w"> </span><span class="nt">&lt;/gasPrice&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">GASLIMIT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gasLimit&gt;</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nt">&lt;/gasLimit&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">NullStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;COINBASE&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;TIMESTAMP&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;NUMBER&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;DIFFICULTY&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">COINBASE</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CB</span><span class="w">   </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;coinbase&gt;</span><span class="w"> </span><span class="nv">CB</span><span class="w"> </span><span class="nt">&lt;/coinbase&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">TIMESTAMP</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">TS</span><span class="w">   </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;timestamp&gt;</span><span class="w"> </span><span class="nv">TS</span><span class="w"> </span><span class="nt">&lt;/timestamp&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">NUMBER</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">NUMB</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;number&gt;</span><span class="w"> </span><span class="nv">NUMB</span><span class="w"> </span><span class="nt">&lt;/number&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">DIFFICULTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DIFF</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;difficulty&gt;</span><span class="w"> </span><span class="nv">DIFF</span><span class="w"> </span><span class="nt">&lt;/difficulty&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">NullStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;ADDRESS&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;ORIGIN&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;CALLER&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;CALLVALUE&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">ADDRESS</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">ORIGIN</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ORG</span><span class="w">  </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;origin&gt;</span><span class="w"> </span><span class="nv">ORG</span><span class="w"> </span><span class="nt">&lt;/origin&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">CALLER</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CL</span><span class="w">   </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;caller&gt;</span><span class="w"> </span><span class="nv">CL</span><span class="w"> </span><span class="nt">&lt;/caller&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">CALLVALUE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CV</span><span class="w">   </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;callValue&gt;</span><span class="w"> </span><span class="nv">CV</span><span class="w"> </span><span class="nt">&lt;/callValue&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">NullStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;MSIZE&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;CODESIZE&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">MSIZE</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="err">*</span><span class="nv">Word</span><span class="w"> </span><span class="nv">MU</span><span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;memoryUsed&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="nt">&lt;/memoryUsed&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">CODESIZE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">PGM</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;programBytes&gt;</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="nt">&lt;/programBytes&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">TernStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;CODECOPY&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">CODECOPY</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="w"> </span><span class="nv">PGMSTART</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;programBytes&gt;</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="nt">&lt;/programBytes&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">PGMSTART</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;BLOCKHASH&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">BLOCKHASH</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">HI</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">HI</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">#parseHexWord</span><span class="p">(</span><span class="nv">Keccak256</span><span class="p">(</span><span class="nv">Int2String</span><span class="p">(</span><span class="nv">N</span><span class="p">)))</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;number&gt;</span><span class="w"> </span><span class="nv">HI</span><span class="w"> </span><span class="nt">&lt;/number&gt;</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">BLOCKHASH</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#blockhash</span><span class="p">(</span><span class="nv">HASHES</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">HI</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;number&gt;</span><span class="w"> </span><span class="nv">HI</span><span class="w"> </span><span class="nt">&lt;/number&gt;</span><span class="w"> </span><span class="nt">&lt;blockhash&gt;</span><span class="w"> </span><span class="nv">HASHES</span><span class="w"> </span><span class="nt">&lt;/blockhash&gt;</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">NORMAL</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#blockhash</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">List</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#blockhash</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">HI</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">HI</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#blockhash</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="mi">256</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#blockhash</span><span class="p">(</span><span class="nv">ListItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#blockhash</span><span class="p">(</span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">H</span><span class="p">)</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">H</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#blockhash</span><span class="p">(</span><span class="nv">ListItem</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nv">L</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">HI</span><span class="p">,</span><span class="w"> </span><span class="nv">A</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#blockhash</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">HI</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">owise</span><span class="p">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="jump">
<h3><code class="docutils literal"><span class="pre">JUMP*</span></code><a class="headerlink" href="#jump" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">JUMP*</span></code> family of operations affect the current program counter.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">NullStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;JUMPDEST&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">JUMPDEST</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;JUMP&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">JUMP</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;JUMPI&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">JUMPI</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DEST</span><span class="w">          </span><span class="nt">&lt;/pc&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">JUMPI</span><span class="w"> </span><span class="nv">DEST</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;pc&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">PCOUNT</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="stop-and-return">
<h3><code class="docutils literal"><span class="pre">STOP</span></code> and <code class="docutils literal"><span class="pre">RETURN</span></code><a class="headerlink" href="#stop-and-return" title="Permalink to this headline">¶</a></h3>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">NullStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;STOP&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">STOP</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;RETURN&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">RETURN</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;output&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">LM</span><span class="p">,</span><span class="w"> </span><span class="nv">RETSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="call-data">
<h3>Call Data<a class="headerlink" href="#call-data" title="Permalink to this headline">¶</a></h3>
<p>These operators query about the current <code class="docutils literal"><span class="pre">CALL*</span></code> state.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">NullStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;CALLDATASIZE&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">CALLDATASIZE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">CD</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;CALLDATALOAD&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">CALLDATALOAD</span><span class="w"> </span><span class="nv">DATASTART</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">CD</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">DATASTART</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">])</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">TernStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;CALLDATACOPY&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">CALLDATACOPY</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="w"> </span><span class="nv">DATASTART</span><span class="w"> </span><span class="nv">DATAWIDTH</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">DATASTART</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="nv">DATAWIDTH</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="log-operations">
<h3>Log Operations<a class="headerlink" href="#log-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">LogOp</span><span class="w"></span>
<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">LogOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">LOG</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="c1">// ----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">LOG</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="w"> </span><span class="nv">MEMWIDTH</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;wordStack&gt;</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#drop</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;log&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">(.</span><span class="nv">List</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ListItem</span><span class="p">({</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">#take</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">LM</span><span class="p">,</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">MEMWIDTH</span><span class="p">)</span><span class="w"> </span><span class="p">}))</span><span class="w"> </span><span class="nt">&lt;/log&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">N</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ethereum-network-opcodes">
<h2>Ethereum Network OpCodes<a class="headerlink" href="#ethereum-network-opcodes" title="Permalink to this headline">¶</a></h2>
<p>Operators that require access to the rest of the Ethereum network
world-state can be taken as a first draft of a “blockchain generic”
language.</p>
<div class="section" id="account-queries">
<h3>Account Queries<a class="headerlink" href="#account-queries" title="Permalink to this headline">¶</a></h3>
<p>TODO: It’s unclear what to do in the case of an account not existing for
these operators. <code class="docutils literal"><span class="pre">BALANCE</span></code> is specified to push 0 in this case, but
the others are not specified. For now, I assume that they instantiate an
empty account and use the empty data.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;BALANCE&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">BALANCE</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">BALANCE</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;EXTCODESIZE&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EXTCODESIZE</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">CODE</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;code&gt;</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EXTCODESIZE</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>TODO: What should happen in the case that the account doesn’t exist with
<code class="docutils literal"><span class="pre">EXTCODECOPY</span></code>? Should we pad zeros (for the copied “program”)?</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">QuadStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;EXTCODECOPY&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EXTCODECOPY</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="w"> </span><span class="nv">PGMSTART</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">PGMSTART</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;code&gt;</span><span class="w"> </span><span class="nv">PGM</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">EXTCODECOPY</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="w"> </span><span class="nv">PGMSTART</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="account-storage-operations">
<h3>Account Storage Operations<a class="headerlink" href="#account-storage-operations" title="Permalink to this headline">¶</a></h3>
<p>These operations interact with the account storage.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;SLOAD&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SLOAD</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">STORAGE</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SLOAD</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">BinStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;SSTORE&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SSTORE</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">(</span><span class="nv">INDEX</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">OLD</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;refund&gt;</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">OLD</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                       </span><span class="nv">#then</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="err">+</span><span class="nv">Word</span><span class="w"> </span><span class="nv">Rsstoreclear</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>
<span class="w">                       </span><span class="nv">#else</span><span class="w"> </span><span class="nv">R</span><span class="w"></span>
<span class="w">                      </span><span class="nv">#fi</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/refund&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SSTORE</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="err">&lt;-</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">INDEX</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">STORAGE</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="call-operations">
<h3>Call Operations<a class="headerlink" href="#call-operations" title="Permalink to this headline">¶</a></h3>
<p>The various <code class="docutils literal"><span class="pre">CALL*</span></code> (and other inter-contract control flow) operations
will be desugared into these <code class="docutils literal"><span class="pre">InternalOp</span></code>s.</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">callLog</span></code> is used to store the <code class="docutils literal"><span class="pre">CALL*</span></code>/<code class="docutils literal"><span class="pre">CREATE</span></code> operations
so that we can compare them against the test-set.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Call</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="s">&quot;}&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#call_____</span></code> takes the calling account, the account to execute as,
the account whose code should execute, the gas limit, the amount to
transfer, and the arguments.</li>
<li><code class="docutils literal"><span class="pre">#callWithCode______</span></code> takes the calling account, the accout to
execute as, the code to execute (as a map), the gas limit, the amount
to transfer, and the arguments.</li>
<li><code class="docutils literal"><span class="pre">#return__</span></code> is a placeholder for the calling program, specifying
where to place the returned data in memory.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#checkCall&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#call&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"></span>
<span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#callWithCode&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"></span>
<span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#mkCall&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#checkCall</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#call</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#refund</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushWorldState</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushSubstate</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1024</span><span class="w"></span>

<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#checkCall</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#call</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">APPVALUE</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#callWithCode</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">#precompiled</span><span class="p">(</span><span class="nv">ACCTCODE</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">APPVALUE</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#call</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">APPVALUE</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#callWithCode</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="p">(</span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="nv">CODE</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">))</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">APPVALUE</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;code&gt;</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#call</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">APPVALUE</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#callWithCode</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">APPVALUE</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">ACCTCODE</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#callWithCode</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nv">BYTES</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">APPVALUE</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"></span>
<span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#pushCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushWorldState</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushSubstate</span><span class="w"></span>
<span class="w">     </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#transferFunds</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"></span>
<span class="w">     </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#mkCall</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nv">BYTES</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">APPVALUE</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#mkCall</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nv">BYTES</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">APPVALUE</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#initVM</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">#execute</span><span class="w"> </span><span class="nv">#fi</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callLog&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">(.</span><span class="nv">Set</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#ifSet</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">({</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="p">.</span><span class="nv">Set</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/callLog&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ARGS</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callValue&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">APPVALUE</span><span class="w"> </span><span class="nt">&lt;/callValue&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;caller&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/caller&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;programBytes&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BYTES</span><span class="w"> </span><span class="nt">&lt;/programBytes&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">KItem</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#initVM&quot;</span><span class="w"></span>
<span class="c1">// --------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#initVM</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w">      </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;pc&gt;</span><span class="w">         </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/pc&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;memoryUsed&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="nt">&lt;/memoryUsed&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;output&gt;</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;wordStack&gt;</span><span class="w">  </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/wordStack&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w">   </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">Map</span><span class="w">       </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">KItem</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#return&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="c1">// ----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#return</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#popWorldState</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#popSubstate</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#return</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">#popWorldState</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">#dropWorldState</span><span class="w"> </span><span class="nv">#fi</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#dropSubstate</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#refund</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#setLocalMem</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"> </span><span class="nv">OUT</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;output&gt;</span><span class="w"> </span><span class="nv">OUT</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#refund&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#setLocalMem&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"></span>
<span class="c1">// ------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#refund</span><span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#setLocalMem</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="nv">WS</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nv">#take</span><span class="p">(</span><span class="nv">minInt</span><span class="p">(</span><span class="nv">WIDTH</span><span class="p">,</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">WS</span><span class="p">)),</span><span class="w"> </span><span class="nv">WS</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>For each <code class="docutils literal"><span class="pre">CALL*</span></code> operation, we make a corresponding call to <code class="docutils literal"><span class="pre">#call</span></code>
and a state-change to setup the custom parts of the calling environment.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">CallOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;CALL&quot;</span><span class="w"></span>
<span class="c1">// ------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">CALL</span><span class="w"> </span><span class="nv">GCAP</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">ARGSTART</span><span class="w"> </span><span class="nv">ARGWIDTH</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#checkCall</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#call</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">Ccallgas</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">LM</span><span class="p">,</span><span class="w"> </span><span class="nv">ARGSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">ARGWIDTH</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#return</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;previousGas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/previousGas&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">CallOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;CALLCODE&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">CALLCODE</span><span class="w"> </span><span class="nv">GCAP</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">ARGSTART</span><span class="w"> </span><span class="nv">ARGWIDTH</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#checkCall</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#call</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">Ccallgas</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">LM</span><span class="p">,</span><span class="w"> </span><span class="nv">ARGSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">ARGWIDTH</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#return</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;previousGas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/previousGas&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">CallSixOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;DELEGATECALL&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">DELEGATECALL</span><span class="w"> </span><span class="nv">GCAP</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">ARGSTART</span><span class="w"> </span><span class="nv">ARGWIDTH</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#checkCall</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#call</span><span class="w"> </span><span class="nv">ACCTAPPFROM</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">Ccallgas</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">LM</span><span class="p">,</span><span class="w"> </span><span class="nv">ARGSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">ARGWIDTH</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#return</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;caller&gt;</span><span class="w"> </span><span class="nv">ACCTAPPFROM</span><span class="w"> </span><span class="nt">&lt;/caller&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callValue&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/callValue&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;previousGas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/previousGas&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="account-creation-deletion">
<h3>Account Creation/Deletion<a class="headerlink" href="#account-creation-deletion" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#create____</span></code> transfers the endowment to the new account and
triggers the execution of the initialization code.</li>
<li><code class="docutils literal"><span class="pre">#codeDeposit_</span></code> checks the result of initialization code and
whether the code deposit can be paid, indicating an error if not.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#create&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"></span>
<span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#mkCreate&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#checkCreate&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="c1">// --------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#checkCreate</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#create</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#refund</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushWorldState</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushSubstate</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1024</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#checkCreate</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#create</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">INITCODE</span><span class="w"></span>
<span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#pushCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushWorldState</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#pushSubstate</span><span class="w"></span>
<span class="w">     </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#newAccount</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"></span>
<span class="w">     </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#transferFunds</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"></span>
<span class="w">     </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#mkCreate</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">INITCODE</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#mkCreate</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">INITCODE</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#initVM</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">#execute</span><span class="w"> </span><span class="nv">#fi</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">OLDGAVAIL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;program&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#asMapOpCodes</span><span class="p">(</span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="nv">INITCODE</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/program&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;programBytes&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">INITCODE</span><span class="w"> </span><span class="nt">&lt;/programBytes&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;caller&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/caller&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callLog&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">(.</span><span class="nv">Set</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#ifSet</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">({</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">OLDGAVAIL</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">INITCODE</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="p">.</span><span class="nv">Set</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="nt">&lt;/callLog&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callDepth&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CD</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nt">&lt;/callDepth&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callValue&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nt">&lt;/callValue&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">Gemptyisnonexistent</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">Gemptyisnonexistent</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">KItem</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;#codeDeposit&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#mkCodeDeposit&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"></span>
<span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;#finishCodeDeposit&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"></span>
<span class="c1">// ---------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#codeDeposit</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#popWorldState</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#popSubstate</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#codeDeposit</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#mkCodeDeposit</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#mkCodeDeposit</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">Gcodedeposit</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#deductGas</span><span class="w"> </span><span class="nv">#fi</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finishCodeDeposit</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">OUT</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;output&gt;</span><span class="w"> </span><span class="nv">OUT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">maxCodeSize</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#mkCodeDeposit</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#popWorldState</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#popSubstate</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;output&gt;</span><span class="w"> </span><span class="nv">OUT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="nv">maxCodeSize</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#finishCodeDeposit</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">OUT</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">#popWorldState</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">#dropWorldState</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#dropSubstate</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#refund</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;code&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">OUT</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">EMPTY</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">OUT</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="nv">#fi</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finishCodeDeposit</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">_</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#if</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">VMTESTS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">#popWorldState</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">#dropWorldState</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#dropSubstate</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#refund</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;mode&gt;</span><span class="w"> </span><span class="nv">EXECMODE</span><span class="w"> </span><span class="nt">&lt;/mode&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">FRONTIER</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#exception</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#finishCodeDeposit</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#popCallStack</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#popWorldState</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#popSubstate</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#push</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">FRONTIER</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">CREATE</span></code> will attempt to <code class="docutils literal"><span class="pre">#create</span></code> the account using the
initialization code and cleans up the result with <code class="docutils literal"><span class="pre">#codeDeposit</span></code>.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">TernStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;CREATE&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">CREATE</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="w"> </span><span class="nv">MEMWIDTH</span><span class="w"></span>
<span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#checkCreate</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#create</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">#newAddr</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">NONCE</span><span class="p">)</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">Gstaticcalldepth</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">#allBut64th</span><span class="p">(</span><span class="nv">GAVAIL</span><span class="p">)</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">#range</span><span class="p">(</span><span class="nv">LM</span><span class="p">,</span><span class="w"> </span><span class="nv">MEMSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">MEMWIDTH</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#codeDeposit</span><span class="w"> </span><span class="nv">#newAddr</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">NONCE</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">Gstaticcalldepth</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;localMem&gt;</span><span class="w"> </span><span class="nv">LM</span><span class="w"> </span><span class="nt">&lt;/localMem&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">SELFDESTRUCT</span></code> marks the current account for deletion and transfers
funds out of the current account. Self destructing to yourself, unlike a
regular transfer, destroys the balance in the account, irreparably
losing it.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">UnStackOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;SELFDESTRUCT&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SELFDESTRUCT</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#transferFunds</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">BALFROM</span><span class="w"> </span><span class="p">~&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;selfDestruct&gt;</span><span class="w"> </span><span class="nv">SDS</span><span class="w"> </span><span class="p">(.</span><span class="nv">Set</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/selfDestruct&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;refund&gt;</span><span class="w"> </span><span class="nv">RF</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">SDS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">RF</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">RF</span><span class="w"> </span><span class="err">+</span><span class="nv">Word</span><span class="w"> </span><span class="nv">Rselfdestruct</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="nt">&lt;/refund&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BALFROM</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SELFDESTRUCT</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;schedule&gt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="nt">&lt;/schedule&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;selfDestruct&gt;</span><span class="w"> </span><span class="nv">SDS</span><span class="w"> </span><span class="p">(.</span><span class="nv">Set</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SetItem</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">))</span><span class="w"> </span><span class="nt">&lt;/selfDestruct&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;refund&gt;</span><span class="w"> </span><span class="nv">RF</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">SDS</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">RF</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">RF</span><span class="w"> </span><span class="err">+</span><span class="nv">Word</span><span class="w"> </span><span class="nv">Rselfdestruct</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">#fi</span><span class="w"> </span><span class="nt">&lt;/refund&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BALFROM</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;nonce&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="nt">&lt;/nonce&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;code&gt;</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="nt">&lt;/code&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">NONCE</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">CODE</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="precompiled-contracts">
<h1>Precompiled Contracts<a class="headerlink" href="#precompiled-contracts" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#precompiled</span></code> is a placeholder for the 4 pre-compiled contracts at
addresses 1 through 4.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">NullStackOp</span><span class="w">   </span><span class="p">::=</span><span class="w"> </span><span class="nv">PrecompiledOp</span><span class="w"></span>
<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">PrecompiledOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#precompiled</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#precompiled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ECREC</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#precompiled</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SHA256</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#precompiled</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">RIP160</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#precompiled</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ID</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ECREC</span></code> performs ECDSA public key recovery.</li>
<li><code class="docutils literal"><span class="pre">SHA256</span></code> performs the SHA2-257 hash function.</li>
<li><code class="docutils literal"><span class="pre">RIP160</span></code> performs the RIPEMD-160 hash function.</li>
<li><code class="docutils literal"><span class="pre">ID</span></code> is the identity function (copies input to output).</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">PrecompiledOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;ECREC&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">ECREC</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;output&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#ecrec</span><span class="p">(</span><span class="nv">#sender</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">DATA</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">]),</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">DATA</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">]),</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">DATA</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">]),</span><span class="w"> </span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">DATA</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">96</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">])))</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#ecrec</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Account</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#ecrec</span><span class="p">(.</span><span class="nv">Account</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#ecrec</span><span class="p">(</span><span class="nv">N</span><span class="p">:</span><span class="nv">Int</span><span class="p">)</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#padToWidth</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="nv">#asByteStack</span><span class="p">(</span><span class="nv">N</span><span class="p">))</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">PrecompiledOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;SHA256&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">SHA256</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;output&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#parseHexBytes</span><span class="p">(</span><span class="nv">Sha256</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">DATA</span><span class="p">)))</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">PrecompiledOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;RIP160&quot;</span><span class="w"></span>
<span class="c1">// ---------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">RIP160</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;output&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#padToWidth</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="nv">#parseHexBytes</span><span class="p">(</span><span class="nv">RipEmd160</span><span class="p">(</span><span class="nv">#unparseByteStack</span><span class="p">(</span><span class="nv">DATA</span><span class="p">))))</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">PrecompiledOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;ID&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">ID</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#end</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;output&gt;</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="nt">&lt;/output&gt;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="ethereum-gas-calculation">
<h1>Ethereum Gas Calculation<a class="headerlink" href="#ethereum-gas-calculation" title="Permalink to this headline">¶</a></h1>
<p>The gas calculation is designed to mirror the style of the yellowpaper.
Gas is consumed either by increasing the amount of memory being used, or
by executing opcodes.</p>
<div class="section" id="memory-consumption">
<h2>Memory Consumption<a class="headerlink" href="#memory-consumption" title="Permalink to this headline">¶</a></h2>
<p>Memory consumed is tracked to determine the appropriate amount of gas to
charge for each operation. In the yellowpaper, each opcode is defined to
consume zero gas unless specified otherwise next to the semantics of the
opcode (appendix H).</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#memory</span></code> computes the new memory size given the old size and next
operator (with its arguments).</li>
<li><code class="docutils literal"><span class="pre">#memoryUsageUpdate</span></code> is the function <code class="docutils literal"><span class="pre">M</span></code> in appendix H of the
yellowpaper which helps track the memory used.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">MLOAD</span><span class="w"> </span><span class="nv">INDEX</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">INDEX</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">MSTORE</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="nv">_</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">INDEX</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">MSTORE8</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">INDEX</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">SHA3</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">LOG</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">CODECOPY</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">EXTCODECOPY</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">CALLDATACOPY</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">CREATE</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">RETURN</span><span class="w"> </span><span class="nv">START</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">COP</span><span class="p">:</span><span class="nv">CallOp</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">ARGSTART</span><span class="w"> </span><span class="nv">ARGWIDTH</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">ARGSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">ARGWIDTH</span><span class="p">),</span><span class="w"> </span><span class="nv">RETSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">CSOP</span><span class="p">:</span><span class="nv">CallSixOp</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w">   </span><span class="nv">ARGSTART</span><span class="w"> </span><span class="nv">ARGWIDTH</span><span class="w"> </span><span class="nv">RETSTART</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">ARGSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">ARGWIDTH</span><span class="p">),</span><span class="w"> </span><span class="nv">RETSTART</span><span class="p">,</span><span class="w"> </span><span class="nv">RETWIDTH</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Grumble grumble, K sucks at <code class="docutils literal"><span class="pre">owise</span></code>.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">JUMP</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">    </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">JUMPI</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">JUMPDEST</span><span class="p">,</span><span class="w">  </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">SSTORE</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">   </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">SLOAD</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">      </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">ADD</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">        </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">SUB</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">        </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">MUL</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">        </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">DIV</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">        </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">EXP</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">        </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">MOD</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">        </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">SDIV</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">       </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">SMOD</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">       </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">SIGNEXTEND</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">ADDMOD</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">   </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">MULMOD</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">   </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">NOT</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">     </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">AND</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">   </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">EVMOR</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">XOR</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">   </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">BYTE</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">  </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">ISZERO</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">  </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">LT</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">         </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">GT</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">         </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">SLT</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">        </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">SGT</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">        </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">EQ</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">         </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">POP</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">      </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">),</span><span class="w"> </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">DUP</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">   </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">SWAP</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">  </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">STOP</span><span class="p">,</span><span class="w">         </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">ADDRESS</span><span class="p">,</span><span class="w">      </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">ORIGIN</span><span class="p">,</span><span class="w">       </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">CALLER</span><span class="p">,</span><span class="w">       </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">CALLVALUE</span><span class="p">,</span><span class="w">    </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">CALLDATASIZE</span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">CODESIZE</span><span class="p">,</span><span class="w">     </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">GASPRICE</span><span class="p">,</span><span class="w">     </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">COINBASE</span><span class="p">,</span><span class="w">     </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">TIMESTAMP</span><span class="p">,</span><span class="w">    </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">NUMBER</span><span class="p">,</span><span class="w">       </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">DIFFICULTY</span><span class="p">,</span><span class="w">   </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">GASLIMIT</span><span class="p">,</span><span class="w">     </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">PC</span><span class="p">,</span><span class="w">           </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">MSIZE</span><span class="p">,</span><span class="w">        </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">GAS</span><span class="p">,</span><span class="w">          </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">SELFDESTRUCT</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">CALLDATALOAD</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">EXTCODESIZE</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">  </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">BALANCE</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">      </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">BLOCKHASH</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w">    </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memory</span><span class="p">(</span><span class="nv">_</span><span class="p">:</span><span class="nv">PrecompiledOp</span><span class="p">,</span><span class="w"> </span><span class="nv">MU</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MU</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#memoryUsageUpdate</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="nv">START</span><span class="p">,</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">maxInt</span><span class="p">(</span><span class="nv">MU</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">START</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">WIDTH</span><span class="w"> </span><span class="err">&gt;</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="execution-gas">
<h2>Execution Gas<a class="headerlink" href="#execution-gas" title="Permalink to this headline">¶</a></h2>
<p>Each opcode has an intrinsic gas cost of execution as well (appendix H
of the yellowpaper).</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#gasExec</span></code> loads all the relevant surronding state and uses that to
compute the intrinsic execution gas of each opcode.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">InternalOp</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#gasExec</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SSTORE</span><span class="w"> </span><span class="nv">INDEX</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Csstore</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">,</span><span class="w"> </span><span class="nv">#lookup</span><span class="p">(</span><span class="nv">STORAGE</span><span class="p">,</span><span class="w"> </span><span class="nv">INDEX</span><span class="p">))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;storage&gt;</span><span class="w"> </span><span class="nv">STORAGE</span><span class="w"> </span><span class="nt">&lt;/storage&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gexp</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">EXP</span><span class="w"> </span><span class="nv">W0</span><span class="w"> </span><span class="nv">W1</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gexp</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">Gexpbyte</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">log256Int</span><span class="p">(</span><span class="nv">W1</span><span class="p">))))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W1</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CALLDATACOPY</span><span class="w">  </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w">     </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">Gcopy</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">WIDTH</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CODECOPY</span><span class="w">      </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w">     </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">Gcopy</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">WIDTH</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">EXTCODECOPY</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gextcodecopy</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">Gcopy</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">WIDTH</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">LOG</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">Glog</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">Glogdata</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Glogtopic</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="p">))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CALL</span><span class="w">         </span><span class="nv">GCAP</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Ccall</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="p">,</span><span class="w">   </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CALLCODE</span><span class="w">     </span><span class="nv">GCAP</span><span class="w"> </span><span class="nv">_</span><span class="w">      </span><span class="nv">VALUE</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Ccall</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">DELEGATECALL</span><span class="w"> </span><span class="nv">GCAP</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Ccall</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;gas&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="nt">&lt;/gas&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SELFDESTRUCT</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Cselfdestruct</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTTO</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">BAL</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;activeAccounts&gt;</span><span class="w"> </span><span class="nv">ACCTS</span><span class="w"> </span><span class="nt">&lt;/activeAccounts&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;id&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/id&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;account&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;acctID&gt;</span><span class="w"> </span><span class="nv">ACCTFROM</span><span class="w"> </span><span class="nt">&lt;/acctID&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nt">&lt;balance&gt;</span><span class="w"> </span><span class="nv">BAL</span><span class="w"> </span><span class="nt">&lt;/balance&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="nt">&lt;/account&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CREATE</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gcreate</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SHA3</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">WIDTH</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gsha3</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">Gsha3word</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">WIDTH</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">JUMPDEST</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gjumpdest</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SLOAD</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gsload</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// Wzero</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">STOP</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gzero</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">RETURN</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gzero</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// Wbase</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ADDRESS</span><span class="p">)</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ORIGIN</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CALLER</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CALLVALUE</span><span class="p">)</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CALLDATASIZE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CODESIZE</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">GASPRICE</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">COINBASE</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">TIMESTAMP</span><span class="p">)</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">NUMBER</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">DIFFICULTY</span><span class="p">)</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">GASLIMIT</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">POP</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">PC</span><span class="p">)</span><span class="w">           </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">MSIZE</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">GAS</span><span class="p">)</span><span class="w">          </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbase</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// Wverylow</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ADD</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SUB</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">NOT</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">          </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">LT</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">GT</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SLT</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SGT</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">EQ</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">         </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ISZERO</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">AND</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">EVMOR</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">XOR</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">BYTE</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">CALLDATALOAD</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">MLOAD</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">MSTORE</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">MSTORE8</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="p">))</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">DUP</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SWAP</span><span class="p">(</span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">      </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// Wlow</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">MUL</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Glow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">DIV</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Glow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SDIV</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Glow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">MOD</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">        </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Glow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SMOD</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Glow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">SIGNEXTEND</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Glow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// Wmid</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ADDMOD</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gmid</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">MULMOD</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gmid</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">JUMP</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gmid</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// Whigh</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">JUMPI</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Ghigh</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">EXTCODESIZE</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gextcodesize</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">BALANCE</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gbalance</span><span class="w">     </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">BLOCKHASH</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w">   </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gblockhash</span><span class="w">   </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// Precompiled</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ECREC</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">3000</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">SHA256</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w">  </span><span class="mi">60</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w">  </span><span class="mi">12</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">DATA</span><span class="p">)</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">RIP160</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">600</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="mi">120</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">DATA</span><span class="p">)</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nt">&lt;k&gt;</span><span class="w"> </span><span class="nv">#gasExec</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ID</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w">  </span><span class="mi">15</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w">   </span><span class="mi">3</span><span class="w"> </span><span class="err">*</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">#sizeWordStack</span><span class="p">(</span><span class="nv">DATA</span><span class="p">)</span><span class="w"> </span><span class="nv">up</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="nt">&lt;/k&gt;</span><span class="w"> </span><span class="nt">&lt;callData&gt;</span><span class="w"> </span><span class="nv">DATA</span><span class="w"> </span><span class="nt">&lt;/callData&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>There are several helpers for calculating gas (most of them also
specified in the yellowpaper).</p>
<p>Note: These are all functions as the operator <code class="docutils literal"><span class="pre">#gasExec</span></code> has already
loaded all the relevant state.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Csstore</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Csstore</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">,</span><span class="w"> </span><span class="nv">OLD</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#ifInt</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">OLD</span><span class="w"> </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">#then</span><span class="w"> </span><span class="nv">Gsstoreset</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">#else</span><span class="w"> </span><span class="nv">Gsstorereset</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">#fi</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Ccall</span><span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Ccallgas</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Cgascap</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">             </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Cextra</span><span class="w">   </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">             </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Cxfer</span><span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">                         </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nv">Cnew</span><span class="w">     </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w">             </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Ccall</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Cextra</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Cgascap</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">Cextra</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">))</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Ccallgas</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">     </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Cgascap</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">Cextra</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w">     </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Ccallgas</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Cgascap</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">Cextra</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">))</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Gcallstipend</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cgascap</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">GEXTRA</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">minInt</span><span class="p">(</span><span class="nv">#allBut64th</span><span class="p">(</span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GEXTRA</span><span class="p">),</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GEXTRA</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">Gstaticcalldepth</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cgascap</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">GCAP</span><span class="p">,</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">GEXTRA</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GCAP</span><span class="w">                                          </span><span class="nv">requires</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">&lt;</span><span class="nv">Int</span><span class="w">  </span><span class="nv">GEXTRA</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">Gstaticcalldepth</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cextra</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gcall</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Cnew</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Cxfer</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cxfer</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cxfer</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gcallvalue</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cnew</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gnewaccount</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w">         </span><span class="nv">#accountNonexistent</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="p">(</span><span class="nv">VALUE</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">orBool</span><span class="w">          </span><span class="nv">Gzerovaluenewaccountgas</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cnew</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">VALUE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">#accountNonexistent</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"> </span><span class="nv">orBool</span><span class="w">  </span><span class="p">(</span><span class="nv">VALUE</span><span class="w">  </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">Gzerovaluenewaccountgas</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">Cselfdestruct</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cselfdestruct</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">BAL</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gselfdestruct</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">Gnewaccount</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="p">(</span><span class="nv">#accountNonexistent</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">))</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="p">(</span><span class="w">        </span><span class="nv">Gselfdestructnewaccount</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="p">(</span><span class="nv">BAL</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">orBool</span><span class="w">          </span><span class="nv">Gzerovaluenewaccountgas</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cselfdestruct</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">BAL</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gselfdestruct</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="p">(</span><span class="nv">#accountNonexistent</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">))</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="p">(</span><span class="nv">notBool</span><span class="w"> </span><span class="nv">Gselfdestructnewaccount</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w">  </span><span class="nv">orBool</span><span class="w">  </span><span class="p">(</span><span class="nv">BAL</span><span class="w">  </span><span class="o">==</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">Gzerovaluenewaccountgas</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Cselfdestruct</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">,</span><span class="w"> </span><span class="nv">BAL</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gselfdestruct</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">#accountNonexistent</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#accountNonexistent</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="nv">#accountEmpty</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="p">)</span><span class="w">                  </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// -----------------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#accountNonexistent</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">notBool</span><span class="w"> </span><span class="nv">ACCT</span><span class="w"> </span><span class="nv">in_keys</span><span class="p">(</span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="p">(</span><span class="nv">#accountEmpty</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="nv">ACCTS</span><span class="p">)</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">Gemptyisnonexistent</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#accountEmpty</span><span class="p">(</span><span class="nv">ACCT</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">ACCT</span><span class="w"> </span><span class="p">|-&gt;</span><span class="w"> </span><span class="nv">EMPTY</span><span class="p">)</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#allBut64th</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ---------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#allBut64th</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="p">(</span><span class="nv">N</span><span class="w"> </span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">64</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">G0</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ------------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">G0</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">,</span><span class="w"> </span><span class="nv">true</span><span class="p">)</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gtxcreate</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">G0</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">,</span><span class="w"> </span><span class="nv">false</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gtransaction</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">G0</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">REST</span><span class="p">,</span><span class="w"> </span><span class="nv">ISCREATE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gtxdatazero</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">G0</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="p">,</span><span class="w"> </span><span class="nv">ISCREATE</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">G0</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">REST</span><span class="p">,</span><span class="w"> </span><span class="nv">ISCREATE</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">Gtxdatanonzero</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">G0</span><span class="p">(</span><span class="nv">SCHED</span><span class="p">,</span><span class="w"> </span><span class="nv">REST</span><span class="p">,</span><span class="w"> </span><span class="nv">ISCREATE</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="p">=/=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;G*&quot;</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">G</span><span class="err">*</span><span class="p">(</span><span class="nv">GAVAIL</span><span class="p">,</span><span class="w"> </span><span class="nv">GLIMIT</span><span class="p">,</span><span class="w"> </span><span class="nv">REFUND</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="w"> </span><span class="err">+</span><span class="nv">Int</span><span class="w"> </span><span class="nv">minInt</span><span class="p">((</span><span class="nv">GLIMIT</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="nv">GAVAIL</span><span class="p">)</span><span class="err">/</span><span class="nv">Int</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nv">REFUND</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="fee-schedule-from-c-implementation">
<h2>Fee Schedule from C++ Implementation<a class="headerlink" href="#fee-schedule-from-c-implementation" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/ethereum/cpp-ethereum">C++ Implementation of
EVM</a> specifies several
different “profiles” for how the VM works. Here we provide each protocol
from the C++ implementation, as the yellowpaper does not contain all the
different profiles. Specify which profile by passing in the argument
<code class="docutils literal"><span class="pre">-cSCHEDULE=&lt;FEE_SCHEDULE&gt;</span></code> when calling <code class="docutils literal"><span class="pre">krun</span></code> (the available
<code class="docutils literal"><span class="pre">&lt;FEE_SCHEDULE&gt;</span></code> are supplied here).</p>
<p>A <code class="docutils literal"><span class="pre">ScheduleFlag</span></code> is a boolean determined by the fee schedule; applying
a <code class="docutils literal"><span class="pre">ScheduleFlag</span></code> to a <code class="docutils literal"><span class="pre">Schedule</span></code> yields whether the flag is set or
not.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Bool</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">ScheduleFlag</span><span class="w"> </span><span class="s">&quot;&lt;&lt;&quot;</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="s">&quot;&gt;&gt;&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// ----------------------------------------------------------</span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">ScheduleFlag</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;Gselfdestructnewaccount&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gstaticcalldepth&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gemptyisnonexistent&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gzerovaluenewaccountgas&quot;</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>A <code class="docutils literal"><span class="pre">ScheduleConst</span></code> is a constant determined by the fee schedule;
applying a <code class="docutils literal"><span class="pre">ScheduleConst</span></code> to a <code class="docutils literal"><span class="pre">Schedule</span></code> yields the correct
constant for that schedule.</p>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">ScheduleConst</span><span class="w"> </span><span class="s">&quot;&lt;&quot;</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="s">&quot;&gt;&quot;</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="c1">// --------------------------------------------------------</span>

<span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">ScheduleConst</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;Gzero&quot;</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gbase&quot;</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gverylow&quot;</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Glow&quot;</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gmid&quot;</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Ghigh&quot;</span><span class="w"></span>
<span class="w">                          </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gextcodesize&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gextcodecopy&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gbalance&quot;</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gsload&quot;</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gjumpdest&quot;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gsstoreset&quot;</span><span class="w"></span>
<span class="w">                          </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gsstorereset&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Rsstoreclear&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Rselfdestruct&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gselfdestruct&quot;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gcreate&quot;</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gcodedeposit&quot;</span><span class="w"></span>
<span class="w">                          </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gcall&quot;</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gcallvalue&quot;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gcallstipend&quot;</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gnewaccount&quot;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gexp&quot;</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gexpbyte&quot;</span><span class="w"></span>
<span class="w">                          </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gmemory&quot;</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gtxcreate&quot;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gtxdatazero&quot;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gtxdatanonzero&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gtransaction&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Glog&quot;</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Glogdata&quot;</span><span class="w"></span>
<span class="w">                          </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Glogtopic&quot;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gsha3&quot;</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gsha3word&quot;</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gcopy&quot;</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gblockhash&quot;</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;Gquadcoeff&quot;</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;maxCodeSize&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------------------------------------------------------------------------------------------------------------------</span>
</pre></div>
</div>
<div class="section" id="defualt-schedule">
<h3>Defualt Schedule<a class="headerlink" href="#defualt-schedule" title="Permalink to this headline">¶</a></h3>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;DEFAULT&quot;</span><span class="w"></span>
<span class="c1">// -----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gzero</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gbase</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gverylow</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Glow</span><span class="w">     </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gmid</span><span class="w">     </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Ghigh</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gexp</span><span class="w">      </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gexpbyte</span><span class="w">  </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gsha3</span><span class="w">     </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">30</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gsha3word</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gsload</span><span class="w">       </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gsstoreset</span><span class="w">   </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">20000</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gsstorereset</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">5000</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Rsstoreclear</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">15000</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Glog</span><span class="w">      </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">375</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Glogdata</span><span class="w">  </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Glogtopic</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">375</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gcall</span><span class="w">        </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gcallstipend</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2300</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gcallvalue</span><span class="w">   </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">9000</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gnewaccount</span><span class="w">  </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">25000</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gcreate</span><span class="w">       </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">32000</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gcodedeposit</span><span class="w">  </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">200</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gselfdestruct</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Rselfdestruct</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">24000</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gmemory</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gquadcoeff</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">512</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gcopy</span><span class="w">      </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gtransaction</span><span class="w">   </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">21000</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gtxcreate</span><span class="w">      </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">53000</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gtxdatazero</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gtxdatanonzero</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">68</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gjumpdest</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gbalance</span><span class="w">     </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gblockhash</span><span class="w">   </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gextcodesize</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gextcodecopy</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">maxCodeSize</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">^</span><span class="nv">Int</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gselfdestructnewaccount</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gstaticcalldepth</span><span class="w">        </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">true</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gemptyisnonexistent</span><span class="w">     </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gzerovaluenewaccountgas</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">true</span><span class="w"></span>
</pre></div>
</div>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span>struct EVMSchedule
{
    EVMSchedule(): tierStepGas(std::array&lt;unsigned, 8&gt;{{0, 2, 3, 5, 8, 10, 20, 0}}) {}
    EVMSchedule(bool _efcd, bool _hdc, unsigned const&amp; _txCreateGas): exceptionalFailedCodeDeposit(_efcd), haveDelegateCall(_hdc), tierStepGas(std::array&lt;unsigned, 8&gt;{{0, 2, 3, 5, 8, 10, 20, 0}}), txCreateGas(_txCreateGas) {}
    bool exceptionalFailedCodeDeposit = true;
    bool haveDelegateCall = true;
    bool eip150Mode = false;
    bool eip158Mode = false;
    bool haveRevert = false;
    bool haveReturnData = false;
    bool haveStaticCall = false;
    bool haveCreate2 = false;
    std::array&lt;unsigned, 8&gt; tierStepGas;

    unsigned expGas = 10;
    unsigned expByteGas = 10;
    unsigned sha3Gas = 30;
    unsigned sha3WordGas = 6;

    unsigned sloadGas = 50;
    unsigned sstoreSetGas = 20000;
    unsigned sstoreResetGas = 5000;
    unsigned sstoreRefundGas = 15000;

    unsigned logGas = 375;
    unsigned logDataGas = 8;
    unsigned logTopicGas = 375;

    unsigned callGas = 40;
    unsigned callStipend = 2300;
    unsigned callValueTransferGas = 9000;
    unsigned callNewAccountGas = 25000;

    unsigned createGas = 32000;
    unsigned createDataGas = 200;
    unsigned suicideGas = 0;
    unsigned suicideRefundGas = 24000;

    unsigned memoryGas = 3;
    unsigned quadCoeffDiv = 512;
    unsigned copyGas = 3;

    unsigned txGas = 21000;
    unsigned txCreateGas = 53000;
    unsigned txDataZeroGas = 4;
    unsigned txDataNonZeroGas = 68;

    unsigned jumpdestGas = 1;
    unsigned balanceGas = 20;
    unsigned blockhashGas = 20;
    unsigned extcodesizeGas = 20;
    unsigned extcodecopyGas = 20;

    unsigned maxCodeSize = unsigned(-1);

    bool staticCallDepthLimit() const { return !eip150Mode; }
    bool suicideNewAccountGas() const { return !eip150Mode; }
    bool suicideChargesNewAccountGas() const { return eip150Mode; }
    bool emptinessIsNonexistence() const { return eip158Mode; }
    bool zeroValueTransferChargesNewAccountGas() const { return !eip158Mode; }
};
</pre></div>
</div>
</div>
<div class="section" id="frontier-schedule">
<h3>Frontier Schedule<a class="headerlink" href="#frontier-schedule" title="Permalink to this headline">¶</a></h3>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;FRONTIER&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gtxcreate</span><span class="w">  </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">FRONTIER</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">21000</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">FRONTIER</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gtxcreate</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDFLAG</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">FRONTIER</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDFLAG</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"></span>
</pre></div>
</div>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">const</span> <span class="n">EVMSchedule</span> <span class="n">FrontierSchedule</span> <span class="o">=</span> <span class="n">EVMSchedule</span><span class="p">(</span><span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="mi">21000</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="homestead-schedule">
<h3>Homestead Schedule<a class="headerlink" href="#homestead-schedule" title="Permalink to this headline">¶</a></h3>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;HOMESTEAD&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">HOMESTEAD</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDFLAG</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">HOMESTEAD</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDFLAG</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"></span>
</pre></div>
</div>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">const</span> <span class="n">EVMSchedule</span> <span class="n">HomesteadSchedule</span> <span class="o">=</span> <span class="n">EVMSchedule</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="mi">53000</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="eip150-schedule">
<h3>EIP150 Schedule<a class="headerlink" href="#eip150-schedule" title="Permalink to this headline">¶</a></h3>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;EIP150&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gbalance</span><span class="w">      </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">400</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gsload</span><span class="w">        </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">200</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gcall</span><span class="w">         </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">700</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gselfdestruct</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">5000</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gextcodesize</span><span class="w">  </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">700</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gextcodecopy</span><span class="w">  </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">700</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">HOMESTEAD</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w">      </span><span class="p">(</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gbalance</span><span class="w">      </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gsload</span><span class="w">       </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gcall</span><span class="w"></span>
<span class="w">                      </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gselfdestruct</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gextcodesize</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gextcodecopy</span><span class="w"></span>
<span class="w">                           </span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gselfdestructnewaccount</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">true</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gstaticcalldepth</span><span class="w">        </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w">              </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">HOMESTEAD</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w">      </span><span class="p">(</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gselfdestructnewaccount</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gstaticcalldepth</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">const</span> <span class="n">EVMSchedule</span> <span class="n">EIP150Schedule</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">{</span>
    <span class="n">EVMSchedule</span> <span class="n">schedule</span> <span class="o">=</span> <span class="n">HomesteadSchedule</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">eip150Mode</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">extcodesizeGas</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">extcodecopyGas</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">balanceGas</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">sloadGas</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">callGas</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">suicideGas</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">schedule</span><span class="p">;</span>
<span class="p">}();</span>
</pre></div>
</div>
</div>
<div class="section" id="eip158-schedule">
<h3>EIP158 Schedule<a class="headerlink" href="#eip158-schedule" title="Permalink to this headline">¶</a></h3>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;EIP158&quot;</span><span class="w"></span>
<span class="c1">// ----------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gexpbyte</span><span class="w">    </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP158</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">maxCodeSize</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP158</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">24576</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w">  </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP158</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gexpbyte</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">maxCodeSize</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gemptyisnonexistent</span><span class="w">     </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">EIP158</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">true</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gzerovaluenewaccountgas</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">EIP158</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">false</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w">              </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">EIP158</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">EIP150</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">notBool</span><span class="w">      </span><span class="p">(</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gemptyisnonexistent</span><span class="w"> </span><span class="nv">orBool</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="o">==</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gzerovaluenewaccountgas</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">const</span> <span class="n">EVMSchedule</span> <span class="n">EIP158Schedule</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">{</span>
    <span class="n">EVMSchedule</span> <span class="n">schedule</span> <span class="o">=</span> <span class="n">EIP150Schedule</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">expByteGas</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">eip158Mode</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">maxCodeSize</span> <span class="o">=</span> <span class="mh">0x6000</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">schedule</span><span class="p">;</span>
<span class="p">}();</span>
</pre></div>
</div>
</div>
<div class="section" id="byzantium-schedule">
<h3>Byzantium Schedule<a class="headerlink" href="#byzantium-schedule" title="Permalink to this headline">¶</a></h3>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;BYZANTIUM&quot;</span><span class="w"></span>
<span class="c1">// -------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">BYZANTIUM</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">EIP158</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDFLAG</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">BYZANTIUM</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDFLAG</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">EIP158</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"></span>
</pre></div>
</div>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">const</span> <span class="n">EVMSchedule</span> <span class="n">ByzantiumSchedule</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">{</span>
    <span class="n">EVMSchedule</span> <span class="n">schedule</span> <span class="o">=</span> <span class="n">EIP158Schedule</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">haveRevert</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">haveReturnData</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">haveStaticCall</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">blockRewardOverwrite</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span> <span class="o">*</span> <span class="n">ether</span><span class="p">};</span>
    <span class="k">return</span> <span class="n">schedule</span><span class="p">;</span>
<span class="p">}();</span>
</pre></div>
</div>
</div>
<div class="section" id="constantinople-schedule">
<h3>Constantinople Schedule<a class="headerlink" href="#constantinople-schedule" title="Permalink to this headline">¶</a></h3>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">   </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="s">&quot;CONSTANTINOPLE&quot;</span><span class="w"></span>
<span class="c1">// ------------------------------------</span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">Gblockhash</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">CONSTANTINOPLE</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">800</span><span class="w"></span>
<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">CONSTANTINOPLE</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="nv">BYZANTIUM</span><span class="w"> </span><span class="err">&gt;</span><span class="w"></span>
<span class="w">     </span><span class="nv">requires</span><span class="w"> </span><span class="nv">SCHEDCONST</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">Gblockhash</span><span class="w"></span>

<span class="w">   </span><span class="kd">rule</span><span class="w"> </span><span class="nv">SCHEDFLAG</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">CONSTANTINOPLE</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SCHEDFLAG</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="nv">BYZANTIUM</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"></span>
</pre></div>
</div>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">const</span> <span class="n">EVMSchedule</span> <span class="n">ConstantinopleSchedule</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">{</span>
    <span class="n">EVMSchedule</span> <span class="n">schedule</span> <span class="o">=</span> <span class="n">ByzantiumSchedule</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">blockhashGas</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">haveCreate2</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">schedule</span><span class="p">;</span>
<span class="p">}();</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="evm-program-representations">
<h1>EVM Program Representations<a class="headerlink" href="#evm-program-representations" title="Permalink to this headline">¶</a></h1>
<p>EVM programs are represented algebraically in K, but programs can load
and manipulate program data directly. The opcodes <code class="docutils literal"><span class="pre">CODECOPY</span></code> and
<code class="docutils literal"><span class="pre">EXTCODECOPY</span></code> rely on the assembled form of the programs being
present. The opcode <code class="docutils literal"><span class="pre">CREATE</span></code> relies on being able to interperet EVM
data as a program.</p>
<p>This is a program representation dependence, which we might want to
avoid. Perhaps the only program representation dependence we should have
is the hash of the program; doing so achieves:</p>
<ul class="simple">
<li>Program representation independence (different analysis tools on the
language don’t have to ensure they have a common representation of
programs, just a common interperetation of the data-files holding
programs).</li>
<li>Programming language independence (we wouldn’t even have to commit to
a particular language or interperetation of the data-file).</li>
<li>Only depending on the hash allows us to know that we have <em>exactly</em>
the correct data-file (program), and nothing more.</li>
</ul>
<div class="section" id="disassembler">
<h2>Disassembler<a class="headerlink" href="#disassembler" title="Permalink to this headline">¶</a></h2>
<p>After interpreting the strings representing programs as a <code class="docutils literal"><span class="pre">WordStack</span></code>,
it should be changed into an <code class="docutils literal"><span class="pre">OpCodes</span></code> for use by the EVM semantics.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">#dasmOpCodes</span></code> interperets <code class="docutils literal"><span class="pre">WordStack</span></code> as an <code class="docutils literal"><span class="pre">OpCodes</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#dasmPUSH</span></code> handles the case of a <code class="docutils literal"><span class="pre">PushOp</span></code>.</li>
<li><code class="docutils literal"><span class="pre">#dasmOpCode</span></code> interperets a <code class="docutils literal"><span class="pre">Int</span></code> as an <code class="docutils literal"><span class="pre">OpCode</span></code>.</li>
</ul>
<div class="highlight-k"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">)</span><span class="w">           </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">WordStack</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">,</span><span class="w"> </span><span class="nv">klabel</span><span class="p">(</span><span class="nv">#dasmOpCodesAux</span><span class="p">)]</span><span class="w"></span>
<span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="nv">#revOpCodes</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">)</span><span class="w">              </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w"> </span><span class="c1">// -----------------------------------------------------------------------------</span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#revOpCodes</span><span class="p">(</span><span class="nv">#dasmOpCodes</span><span class="p">(.</span><span class="nv">OpCodes</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">),</span><span class="w"> </span><span class="p">.</span><span class="nv">OpCodes</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="nv">WordStack</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">OPS</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="nv">W</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">0</span><span class="w">   </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">95</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="nv">W</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">165</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">255</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="nv">DUP</span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">127</span><span class="p">)</span><span class="w">       </span><span class="p">;</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">143</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="nv">SWAP</span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">143</span><span class="p">)</span><span class="w">      </span><span class="p">;</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">144</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">159</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="nv">LOG</span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">160</span><span class="p">)</span><span class="w">       </span><span class="p">;</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">160</span><span class="w"> </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">164</span><span class="w"></span>

<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">WS</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#dasmOpCodes</span><span class="p">(</span><span class="nv">PUSH</span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="nv">#asWord</span><span class="p">(</span><span class="nv">#take</span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">)))</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">#drop</span><span class="p">(</span><span class="nv">W</span><span class="w"> </span><span class="err">-</span><span class="nv">Int</span><span class="w"> </span><span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="nv">WS</span><span class="p">),</span><span class="w"> </span><span class="nv">SCHED</span><span class="p">)</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&gt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">96</span><span class="w">  </span><span class="nv">andBool</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="err">&lt;</span><span class="o">=</span><span class="nv">Int</span><span class="w"> </span><span class="mi">127</span><span class="w"></span>

<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#revOpCodes</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nv">OPS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">OPS</span><span class="err">&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">#revOpCodes</span><span class="p">(</span><span class="nv">OPS</span><span class="p">,</span><span class="w"> </span><span class="nv">OP</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nv">OPS</span><span class="err">&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#revOpCodes</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nv">OpCodes</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">OPS</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">OPS</span><span class="w"></span>

<span class="w">    </span><span class="kd">syntax</span><span class="w"> </span><span class="nv">OpCode</span><span class="w"> </span><span class="p">::=</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nv">function</span><span class="p">]</span><span class="w"></span>
<span class="w"> </span><span class="c1">// -----------------------------------------------------------</span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="mi">0</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">STOP</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="mi">1</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ADD</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="mi">2</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MUL</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="mi">3</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SUB</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="mi">4</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DIV</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="mi">5</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SDIV</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="mi">6</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MOD</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="mi">7</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SMOD</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="mi">8</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ADDMOD</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="mi">9</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MULMOD</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">10</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">EXP</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">11</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SIGNEXTEND</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">16</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">LT</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">17</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GT</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">18</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SLT</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">19</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SGT</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">20</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">EQ</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">21</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ISZERO</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">22</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">AND</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">23</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">EVMOR</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">24</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">XOR</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">25</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">NOT</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">26</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BYTE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">32</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SHA3</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">48</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ADDRESS</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">49</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BALANCE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">50</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">ORIGIN</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">51</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CALLER</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">52</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CALLVALUE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">53</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CALLDATALOAD</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">54</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CALLDATASIZE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">55</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CALLDATACOPY</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">56</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CODESIZE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">57</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CODECOPY</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">58</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GASPRICE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">59</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">EXTCODESIZE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">60</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">EXTCODECOPY</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">64</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">BLOCKHASH</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">65</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">COINBASE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">66</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">TIMESTAMP</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">67</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">NUMBER</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">68</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DIFFICULTY</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">69</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GASLIMIT</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">80</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">POP</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">81</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MLOAD</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">82</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MSTORE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">83</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MSTORE8</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">84</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SLOAD</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">85</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SSTORE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">86</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">JUMP</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">87</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">JUMPI</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">88</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">PC</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">89</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">MSIZE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">90</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">GAS</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">  </span><span class="mi">91</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">JUMPDEST</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w"> </span><span class="mi">240</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CREATE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w"> </span><span class="mi">241</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CALL</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w"> </span><span class="mi">242</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">CALLCODE</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w"> </span><span class="mi">243</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">RETURN</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w"> </span><span class="mi">244</span><span class="p">,</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">DELEGATECALL</span><span class="w"> </span><span class="nv">requires</span><span class="w"> </span><span class="nv">SCHED</span><span class="w"> </span><span class="p">=/=</span><span class="nv">K</span><span class="w"> </span><span class="nv">FRONTIER</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">SELFDESTRUCT</span><span class="w"></span>
<span class="w">    </span><span class="kd">rule</span><span class="w"> </span><span class="nv">#dasmOpCode</span><span class="p">(</span><span class="w">   </span><span class="nv">W</span><span class="p">,</span><span class="w">     </span><span class="nv">_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nv">INVALID</span><span class="w"> </span><span class="p">[</span><span class="nv">owise</span><span class="p">]</span><span class="w"></span>
<span class="nv">endmodule</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ethereum/" class="btn btn-neutral float-right" title="Ethereum Simulations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../" class="btn btn-neutral" title="The EVM Jello Paper" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, The KEVM Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>